<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kvízová Aplikácia s AI Vysvetlením a Štatistikami</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-main-light: #f3f4f6; /* gray-100 */
            --text-main-light: #1f2937; /* gray-800 */
            --text-muted-light: #6b7280; /* gray-500 */
            --bg-card-light: #ffffff; /* white */
            --bg-card-secondary-light: #f9fafb; /* gray-50 */
            --border-light: #d1d5db; /* gray-300 */
            --button-bg-light: #e5e7eb; /* gray-200 */
            --button-text-light: #111827; /* gray-900 */
            --button-hover-bg-light: #d1d5db; /* gray-300 */
            --input-bg-light: #f9fafb; /* gray-50 */
            --input-border-light: #d1d5db; /* gray-300 */
            --highlight-border-light: #fbbf24; /* amber-500 */
            --highlight-bg-light: #fde68a; /* amber-200 */
            --highlight-text-light: #78350f; /* amber-900 */
            --sky-text-light: #0ea5e9; /* sky-500 */
            --purple-text-light: #8b5cf6; /* violet-500 */
            --amber-text-light: #f59e0b; /* amber-500 */
            --green-text-light: #16a34a; /* green-600 */
            --red-text-light: #dc2626; /* red-600 */

            --bg-main-dark: #0f172a; /* slate-900 */
            --text-main-dark: #f8fafc; /* slate-50 */
            --text-muted-dark: #94a3b8; /* slate-400 */
            --bg-card-dark: #1e293b; /* slate-800 */
            --bg-card-secondary-dark: #334155; /* slate-700 */
            --border-dark: #475569; /* slate-600 */
            --button-bg-dark: #334155; /* slate-700 */
            --button-text-dark: #f8fafc; /* slate-50 */
            --button-hover-bg-dark: #475569; /* slate-600 */
            --input-bg-dark: #334155; /* slate-700 */
            --input-border-dark: #475569; /* slate-600 */
            --highlight-border-dark: #facc15; /* yellow-400 */
            --highlight-bg-dark: #ca8a04; /* yellow-600 */
            --highlight-text-dark: #fefce8; /* yellow-50 */
            --sky-text-dark: #38bdf8; /* sky-400 */
            --purple-text-dark: #a78bfa; /* violet-400 */
            --amber-text-dark: #facc15; /* yellow-400 */
            --green-text-dark: #4ade80; /* green-400 */
            --red-text-dark: #f87171; /* red-400 */
        }

        .dark-mode {
            --bg-main: var(--bg-main-dark);
            --text-main: var(--text-main-dark);
            --text-muted: var(--text-muted-dark);
            --bg-card: var(--bg-card-dark);
            --bg-card-secondary: var(--bg-card-secondary-dark);
            --border-color: var(--border-dark);
            --button-bg: var(--button-bg-dark);
            --button-text: var(--button-text-dark);
            --button-hover-bg: var(--button-hover-bg-dark);
            --input-bg: var(--input-bg-dark);
            --input-text: var(--text-main-dark);
            --input-border: var(--border-dark);
            --select-bg: var(--button-bg-dark);
            --select-text: var(--text-main-dark);
            --highlight-border: var(--highlight-border-dark);
            --highlight-bg: var(--highlight-bg-dark);
            --highlight-text: var(--highlight-text-dark);
            --sky-text: var(--sky-text-dark);
            --purple-text: var(--purple-text-dark);
            --amber-text: var(--amber-text-dark);
            --green-text: var(--green-text-dark);
            --red-text: var(--red-text-dark);
        }

        .light-mode {
            --bg-main: var(--bg-main-light);
            --text-main: var(--text-main-light);
            --text-muted: var(--text-muted-light);
            --bg-card: var(--bg-card-light);
            --bg-card-secondary: var(--bg-card-secondary-light);
            --border-color: var(--border-light);
            --button-bg: var(--button-bg-light);
            --button-text: var(--button-text-light);
            --button-hover-bg: var(--button-hover-bg-light);
            --input-bg: var(--input-bg-light);
            --input-text: var(--text-main-light);
            --input-border: var(--input-border-light);
            --select-bg: var(--button-bg-light);
            --select-text: var(--button-text-light);
            --highlight-border: var(--highlight-border-light);
            --highlight-bg: var(--highlight-bg-light);
            --highlight-text: var(--highlight-text-light);
            --sky-text: var(--sky-text-light);
            --purple-text: var(--purple-text-light);
            --amber-text: var(--amber-text-light);
            --green-text: var(--green-text-light);
            --red-text: var(--red-text-light);
        }

        body { 
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            transition: background-color 0.3s, color 0.3s;
        }
        #app-container {
            background-color: var(--bg-card);
            border: 1px solid var(--border-color);
        }
        .timer-input, #hard-mode-answer-input, select { 
            background-color: var(--input-bg);
            color: var(--input-text);
            border: 1px solid var(--input-border);
        }
        .light-mode select {
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23374151' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        }
        .dark-mode select {
             background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
        }

        .action-button, .difficulty-button, #no-timer-button, #submit-answer-button, #restart-quiz-button, #change-topic-button, #back-to-topics, #explain-answer-button, #get-quiz-analysis-button, .random-test-button, #show-stats-button, #back-to-topics-from-stats { 
            background-color: var(--button-bg);
            color: var(--button-text);
            border: 1px solid var(--border-color);
            transition: background-color 0.2s ease-in-out, transform 0.1s ease, box-shadow 0.2s ease-in-out;
            box-shadow: 0 1px 2px 0 rgba(0,0,0,0.05);
        }
        .action-button:hover, .difficulty-button:hover:not(.active), #no-timer-button:hover, #submit-answer-button:hover, #restart-quiz-button:hover, #change-topic-button:hover, #back-to-topics:hover, #explain-answer-button:hover, #get-quiz-analysis-button:hover, .random-test-button:hover, #show-stats-button:hover, #back-to-topics-from-stats:hover {
            background-color: var(--button-hover-bg);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }
        .action-button:active, .difficulty-button:active, #no-timer-button:active, #submit-answer-button:active, #restart-quiz-button:active, #change-topic-button:active, #back-to-topics:active, #explain-answer-button:active, #get-quiz-analysis-button:active, .random-test-button:active, #show-stats-button:active, #back-to-topics-from-stats:active {
            transform: translateY(0px);
            box-shadow: inset 0 2px 4px 0 rgba(0,0,0,0.06);
        }

        .option-button { 
            background-color: var(--button-bg); 
            color: var(--button-text);
            border: 1px solid var(--border-color);
             padding: 0.75rem 1.25rem; 
             border-radius: 0.5rem; 
        }
        .option-button:hover:not(:disabled) { 
            background-color: var(--button-hover-bg);
        }
        .option-button.selected { background-color: #2563eb; color: white; border-color: #2563eb;}
        .option-button.correct { background-color: #16a34a !important; color: white !important; border-color: #16a34a !important;}
        .option-button.incorrect { background-color: #dc2626 !important; color: white !important; border-color: #dc2626 !important;}
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-card); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
        
        .section-title { border-bottom: 2px solid var(--border-color); }
        
        #restart-quiz-button { background-color: #22c55e; color:white;} 
        #restart-quiz-button:hover { background-color: #16a34a; } 
        #change-topic-button, #back-to-topics, #back-to-topics-from-stats { background-color: #0ea5e9; color:white;}  
        #change-topic-button:hover, #back-to-topics:hover, #back-to-topics-from-stats:hover { background-color: #0284c7; } 
        #submit-answer-button { background-color: #3b82f6; color:white;} 
        #submit-answer-button:hover { background-color: #2563eb; } 
        
        #submit-answer-button.next-question-style { background-color: #22c55e !important; color:white !important; } 
        #submit-answer-button.next-question-style:hover { background-color: #16a34a !important; }

        #explain-answer-button, #get-quiz-analysis-button {
            background-color: #7c3aed; /* violet-600 */
            color: white;
            padding-top: 0.5rem; padding-bottom: 0.5rem; 
            font-size: 0.875rem; 
        }
        #explain-answer-button:hover, #get-quiz-analysis-button:hover {
            background-color: #6d28d9; /* violet-700 */
        }
        .random-test-button {
            background-color: #f59e0b; /* amber-500 */
            color: white;
        }
        .random-test-button:hover {
            background-color: #d97706; /* amber-600 */
        }
        #show-stats-button {
            background-color: #64748b; /* slate-500 */
            color: white;
        }
        #show-stats-button:hover {
            background-color: #475569; /* slate-600 */
        }


        .text-sky-title { color: var(--sky-text); }
        .text-purple-title { color: var(--purple-text); }
        .text-amber-timer { color: var(--amber-text); }
        .text-green-feedback { color: var(--green-text); }
        .text-red-feedback { color: var(--red-text); }
        .text-muted-color { color: var(--text-muted); }
        .bg-card-secondary { background-color: var(--bg-card-secondary); } 

        /* Statistics Table Styles */
        #stats-history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        #stats-history-table th, #stats-history-table td {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            text-align: left;
        }
        #stats-history-table th {
            background-color: var(--bg-card-secondary);
            font-weight: 600;
        }
        #stats-history-table tr:nth-child(even) {
            background-color: var(--bg-card-secondary);
        }
        .dark-mode #stats-history-table tr:nth-child(even) {
             background-color: var(--bg-main-dark); /* Slightly different for dark even rows */
        }


    </style>
</head>
<body class="light-mode"> 

    <div id="app-container" class="p-4 sm:p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-5xl mx-auto my-4 md:my-8"> 

        <div id="topic-selection-screen">
            <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
                <h1 class="text-3xl sm:text-4xl font-bold text-sky-title">Vyber si Test</h1>
                <div class="flex flex-wrap items-center gap-2">
                    <button id="show-stats-button" class="action-button p-2" title="Zobraziť štatistiky">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2 11h14a1 1 0 011 1v6a1 1 0 01-1 1H3a1 1 0 01-1-1v-6a1 1 0 011-1z" />
                            <path fill-rule="evenodd" d="M13 3.5A2.5 2.5 0 0010.5 1h-1A2.5 2.5 0 007 3.5v3A2.5 2.5 0 009.5 9h1A2.5 2.5 0 0013 6.5v-3zm-2.5.5a1 1 0 00-1 1v3a1 1 0 001 1h1a1 1 0 001-1v-3a1 1 0 00-1-1h-1z" clip-rule="evenodd" />
                        </svg>
                    </button>
                    <button id="theme-toggle-button" class="action-button p-2" title="Prepnúť režim">
                        <svg id="theme-icon-sun" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm0 14a1 1 0 01-1 1v1a1 1 0 112 0v-1a1 1 0 01-1-1zm8-7a1 1 0 01-1 1h-1a1 1 0 110-2h1a1 1 0 011 1zM3 10a1 1 0 01-1 1H1a1 1 0 110-2h1a1 1 0 011 1zm14.243-5.243a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM4.464 15.536a1 1 0 010-1.414l.707-.707a1 1 0 011.414 1.414l-.707.707a1 1 0 01-1.414 0zm12.072-8.486a1 1 0 01-1.414 0l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 0zM5.172 5.172a1 1 0 01-1.414 0l-.707-.707a1 1 0 011.414-1.414l.707.707a1 1 0 010 1.414zM10 5a5 5 0 100 10 5 5 0 000-10z" clip-rule="evenodd"></path></svg>
                        <svg id="theme-icon-moon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                    </button>
                    <a href="https://discord.gg/auGUv7HrRH" id="discord-link" target="_blank" class="action-button inline-flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M20.29,3.04C18.88,2.09,17.2,1.4,15.39,1C15.24,1.32,15.07,1.64,14.9,1.98C13.04,1.63,11.1,1.53,9.24,1.93C9.06,1.62,8.89,1.3,8.73,1C6.92,1.4,5.23,2.09,3.83,3.04C1.2,6.86,0.65,10.76,1.34,14.5C1.34,14.5,1.34,14.5,1.34,14.5C2.87,17.94,6.44,20.17,9.95,20.29C10.1,20.62,10.27,20.94,10.45,21.26C11.57,21.58,12.73,21.68,13.9,21.26C14.08,20.95,14.25,20.63,14.4,20.3C17.91,20.17,21.48,17.94,23,14.5C23,14.5,23,14.5,23,14.5C23.62,10.77,23.08,6.86,20.29,3.04ZM8.03,14.05C7.05,14.05,6.25,13.18,6.25,12.11C6.25,11.04,7.04,10.17,8.03,10.17C9.01,10.17,9.81,11.04,9.8,12.11C9.8,13.18,9.01,14.05,8.03,14.05ZM12.05,14.05C11.07,14.05,10.27,13.18,10.27,12.11C10.27,11.04,11.06,10.17,12.05,10.17C13.03,10.17,13.83,11.04,13.82,12.11C13.82,13.18,13.03,14.05,12.05,14.05Z"/></svg>
                        Discord
                    </a>
                    <a href="https://drive.google.com/drive/folders/13pDoRJ0bnu7jWVOFr3sULCWz-WFBpl2H?usp=sharing" id="gdrive-link" target="_blank" class="action-button inline-flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19.009,8.636l-4.455-4.345C14.227,3.964,13.809,3.755,13.364,3.755H6.845c-0.891,0-1.618,0.727-1.618,1.618v13.273c0,0.891,0.727,1.618,1.618,1.618h10.309c0.891,0,1.618-0.727,1.618-1.618V9.364C19.227,8.991,19.145,8.764,19.009,8.636z M13.364,5.082l3.145,3.055h-3.145V5.082z M17.155,18.636H6.845V5.373h5.409v3.982h4.291v9.282H17.155z"/><path d="M8.155 11.218H15.845V12.845H8.155zM8.155 13.645H15.845V15.273H8.155zM8.155 16.073H12.945V17.7H8.155z"/></svg>
                        Google Drive
                    </a>
                </div>
            </div>
            <div class="mb-6 p-4 bg-card-secondary rounded-lg space-y-4">
                <div>
                    <label for="timer-minutes" class="block text-lg mb-2">Časový limit (minúty):</label>
                    <div class="flex items-center gap-4">
                        <input type="number" id="timer-minutes" min="1" value="10" class="timer-input p-2 rounded-lg w-full sm:w-1/2 focus:ring-2 focus:ring-sky-500 outline-none">
                        <button id="no-timer-button" class="action-button py-2 px-4 rounded-lg w-full sm:w-1/2">Bez limitu</button>
                    </div>
                    <p id="timer-info" class="text-sm text-muted-color mt-2">Zadajte počet minút alebo vyberte "Bez limitu".</p>
                </div>
                <!-- Difficulty selection removed -->
            </div>
            <div id="sections-container" class="space-y-8"></div>
        </div>

        <div id="quiz-screen" class="hidden">
             <div class="flex justify-between items-center mb-4">
                <h2 id="quiz-topic-title" class="text-2xl sm:text-3xl font-bold text-sky-title">Názov Testu</h2>
                <button id="back-to-topics" class="action-button">Zmeniť Test</button>
            </div>
            <div id="timer-display" class="text-xl sm:text-2xl font-semibold text-amber-timer mb-4 text-center">
                Zostávajúci čas: <span id="time-left">--:--</span>
            </div>
            
            <div id="question-container" class="mb-6 p-6 bg-card-secondary rounded-lg">
                <p id="question-text" class="text-lg sm:text-xl mb-4 min-h-[60px]"></p>
                <div id="options-container" class="space-y-3">
                </div>
                <!-- Hard mode input is kept for potential future re-introduction, but hidden by default if not used -->
                <input type="text" id="hard-mode-answer-input" class="hidden mt-4 p-2 rounded-lg w-full focus:ring-2 focus:ring-sky-500 outline-none" placeholder="Napíš svoju odpoveď...">
            </div>
            <div id="feedback-container" class="mb-4 min-h-[30px] text-center text-lg">
                <p id="feedback-text"></p>
                <div id="explanation-controls" class="mt-2 hidden">
                    <button id="explain-answer-button" class="action-button text-sm py-1 px-2">✨ Vysvetli správnu odpoveď</button>
                    <p id="explanation-loading" class="text-sm text-muted-color hidden mt-2">✨ Generujem vysvetlenie...</p>
                    <div id="explanation-content" class="mt-2 text-sm text-left p-3 border rounded-md bg-card-secondary hidden"></div>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                <p id="score-text" class="text-xl font-semibold">Skóre: 0/0</p>
                <p id="question-counter-text" class="text-md text-muted-color">Otázka: 1/10</p>
                <button id="submit-answer-button" class="action-button py-3 px-6 w-full sm:w-auto">Potvrdiť Odpoveď</button>
            </div>
        </div>

        <div id="results-screen" class="hidden text-center">
            <h2 class="text-3xl sm:text-4xl font-bold text-sky-title mb-6">Výsledky Testu</h2>
            <p id="final-score-text" class="text-2xl mb-2"></p>
            <p id="probable-grade-time-text" class="text-xl mb-2">Pravdepodobná známka (s časom): <span id="probable-grade-time-value" class="font-bold">--</span></p>
            <p id="result-message-text" class="text-lg mb-4"></p>
            <p id="quiz-duration-text" class="text-md text-muted-color mb-2">Trvanie testu: <span id="quiz-duration-value">--:--</span></p>
            
            <div id="quiz-analysis-container" class="my-6 text-center">
                <button id="get-quiz-analysis-button" class="action-button">✨ Získaj analýzu testu</button>
                <p id="quiz-analysis-loading" class="text-sm text-muted-color mt-2 hidden">✨ Generujem analýzu...</p>
                <div id="quiz-analysis-content" class="mt-2 text-sm text-left p-3 border rounded-md bg-card-secondary hidden"></div>
            </div>

            <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8"> 
                <button id="restart-quiz-button" class="action-button">Zopakovať Test</button>
                <button id="change-topic-button" class="action-button">Vybrať Iný Test</button>
            </div>
        </div>

        <div id="statistics-screen" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl sm:text-4xl font-bold text-purple-title">Moje Štatistiky</h2>
                <button id="back-to-topics-from-stats" class="action-button">Späť na Testy</button>
            </div>
            <div id="stats-loading" class="text-center text-lg text-muted-color my-8 hidden">Načítavam štatistiky...</div>
            <div id="stats-content">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="p-6 bg-card-secondary rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-2 text-sky-title">Celkový Prehľad</h3>
                        <p class="text-lg">Počet absolvovaných testov: <span id="stats-total-tests" class="font-bold">0</span></p>
                        <p class="text-lg">Celkový čas strávený testovaním: <span id="stats-total-time" class="font-bold">0h 0m 0s</span></p>
                        <p id="stats-user-id" class="text-sm text-muted-color mt-2">ID Užívateľa: <span class="font-mono">načítava sa...</span></p>
                    </div>
                     <div class="p-6 bg-card-secondary rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-2 text-sky-title">Priemerné Výsledky (Príklad)</h3>
                        <p class="text-lg">Priemerné skóre: <span id="stats-average-score" class="font-bold">N/A</span></p>
                        <p class="text-lg">Najčastejšia známka: <span id="stats-commonest-grade" class="font-bold">N/A</span></p>
                    </div>
                </div>

                <h3 class="text-2xl font-semibold mb-4 text-purple-title">História Testov</h3>
                <div class="overflow-x-auto rounded-lg shadow border border-[var(--border-color)]">
                    <table id="stats-history-table">
                        <thead>
                            <tr>
                                <th>Názov Testu</th>
                                <th>Dátum</th>
                                <th>Skóre</th>
                                <th>Známka</th>
                                <th>Trvanie</th>
                                <!-- Difficulty column removed -->
                            </tr>
                        </thead>
                        <tbody id="stats-history-table-body">
                            <!-- Riadky budú pridané dynamicky -->
                        </tbody>
                    </table>
                </div>
                 <p id="stats-no-history" class="text-center text-lg text-muted-color my-8 hidden">Zatiaľ nemáš žiadne uložené výsledky testov.</p>
            </div>
        </div>

    </div>

    <script type="module">
        // Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, orderBy, serverTimestamp, Timestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Test Data (Elektrotechnika - pôvodná sekcia) ---
        const testAkcneCleny = `
Test: Akčné členy
1. Čo je hlavnou úlohou akčného člena v regulačnom obvode?
a) Generovať napätie
b) Sledovať teplotu
c) Udržiavať požadovaný stav systému
d) Analyzovať dáta
2. Ktorý prvok zabezpečuje fyzickú reakciu v systéme na základe príkazu z riadiaceho systému?
a) Senzor
b) Aktuátor
c) Algoritmus
d) Displej
3. Aký typ regulátora využíva proporčný, integračný a derivatívny člen?
a) On-Off regulátor
b) PID regulátor
c) Adaptívny regulátor
d) Fuzzy regulátor
4. Ktorý typ pohonu je najvhodnejší pre ťažké priemyselné aplikácie s veľkým výkonom?
a) Pneumatický
b) Elektrický
c) Hydraulický
d) Magnetický
5. Ktorý typ pohonu má výhodu v rýchlom a jednoduchom ovládaní, ale vytvára hluk pri odfuku?
a) Pneumatický
b) Hydraulický
c) Mechanický
d) Servopohon
6. Čo je výhodou elektromechanického pohonu?
a) Nízka hmotnosť a cena
b) Presnosť elektrických pohonov s mechanickou odolnosťou
c) Vysoká hlučnosť a vibrácie
d) Jednoduchá údržba bez potreby mazania
7. Ktorý typ servopohonu je vhodnejší pre manipuláciu s veľkými zaťaženiami pomocou zosilnenia síl?
a) Priamočiary rotačný
b) Pákový
c) Elektromagnetický lineárny
d) Krokový motor
8. Aké médium využívajú pneumatické pohony?
a) Elektrický prúd a magnetické pole
b) Hydraulický olej alebo voda
c) Stlačený vzduch alebo iný plyn
d) Mechanické prevody a páky
9. Čo predstavuje spätná väzba v regulačnom obvode?
a) Príkazový vstup od operátora
b) Výstupný signál do aktuátora
c) Informácia o aktuálnom stave systému vrátená do regulátora
d) Vonkajšie rušenie ovplyvňujúce systém
10. Ktorý regulátor reaguje len prepnutím medzi dvomi stavmi (napr. zapnutý/vypnutý)?
a) PID regulátor
b) On-Off regulátor
c) Derivátor s oneskorením
d) Integračný regulátor so saturáciou
Správne odpovede:
1. c)
2. b)
3. b)
4. c)
5. a)
6. b)
7. b)
8. c)
9. c)
10. b)
        `;
        const testPLC15Otazok = `
Test: Programovateľné logické automaty (PLC)
1. Čo je hlavnou úlohou PLC?
a) Meranie elektrického prúdu a napätia v sieti
b) Riadenie logických funkcií v automatizácii priemyselných procesov
c) Tvorba a distribúcia elektrickej energie pre stroje
d) Analýza a vizualizácia výrobných dát
2. Ktoré z týchto zariadení PLC primárne nahrádza v starších riadiacich systémoch?
a) Kondenzátory a cievky
b) Reléové logické systémy a časovače
c) Solárne panely a batérie
d) Transformátory a meniče frekvencie
3. Aká je hlavná funkcia CPU (centrálnej procesorovej jednotky) v PLC?
a) Ukladá výstupné signály pre aktuátory
b) Spracováva programovú logiku, vykonáva inštrukcie a riadi operácie PLC
c) Napája vstupné a výstupné moduly PLC
d) Zabezpečuje komunikáciu s nadradeným SCADA systémom
4. Čo sú vstupy v PLC systéme?
a) Motory, ventily a signalizačné svetlá
b) Signály z tlačidiel, snímačov polohy, teploty, tlaku a iných senzorov
c) Pamäťové moduly a programovacie káble
d) Displeje operátorských panelov a klávesnice
5. Na čo slúžia výstupy v PLC?
a) Na zobrazovanie diagnostických dát a chybových hlásení
b) Na ovládanie výkonových zariadení ako sú motory, ventily, svetlá, relé, stýkače
c) Na spracovanie logických operácií AND, OR, NOT
d) Na ukladanie histórie alarmov a udalostí
6. Ktorý programovací jazyk pre PLC je grafickým jazykom pripomínajúcim elektrické schémy reléovej logiky?
a) ST (Structured Text)
b) LD (Ladder Diagram)
c) IL (Instruction List)
d) FBD (Function Block Diagram)
7. Čo znamená skratka PLC?
a) Programmable Logic Controller
b) Power Line Communication
c) Process Load Capacitor
d) Programmable Lighting Circuit
8. Aký typ PLC má všetky základné komponenty (CPU, pamäť, I/O) integrované v jednom kompaktnom puzdre?
a) Kompaktné PLC (Brick PLC)
b) Rackové PLC (Modulárne PLC s montážou do racku)
c) Modulárne PLC (s oddelenými modulmi)
d) Softvérové PLC (PC-based PLC)
9. Ktorý typ PLC sa typicky používa v rozsiahlych a komplexných automatizačných systémoch ako sú rafinérie alebo veľké výrobné linky?
a) Softvérové PLC
b) Modulárne PLC (často Rackové)
c) Mikro PLC
d) Jednoúčelové PLC
10. Aká je jedna z hlavných výhod softvérového PLC (PC-based PLC)?
a) Vyžaduje menej programátorskej znalosti
b) Beží na štandardnom priemyselnom alebo bežnom počítači, využívajúc jeho výkon a flexibilitu
c) Má vždy integrované fyzické vstupy a výstupy
d) Je odolnejšie voči priemyselnému rušeniu ako hardvérové PLC
11. Ktorý programovací jazyk pre PLC je textový, vysokoúrovňový a podobný jazyku Pascal alebo C?
a) FBD (Function Block Diagram)
b) IL (Instruction List)
c) ST (Structured Text)
d) SFC (Sequential Function Chart)
12. Ako prebieha základný cyklický sken (scan cycle) PLC?
a) Ukladanie dát na externé médium, aktualizácia firmvéru, diagnostika hardvéru
b) Kontrola stavu vstupov, vykonanie užívateľského programu, aktualizácia stavu výstupov, komunikácia a diagnostika
c) Spracovanie výstupov na základe predikcie, kontrola internej pamäte, filtrovanie šumu zo senzorov
d) Inicializácia hardvéru, načítanie programu z ROM, spustenie operačného systému PLC
13. Na čo primárne slúžia komunikačné rozhrania (napr. Ethernet, RS-485, Profibus) v PLC?
a) Na priame programovanie CPU pomocou binárneho kódu
b) Na výmenu signálov medzi jednotlivými výstupnými modulmi
c) Na prepojenie s HMI panelmi, SCADA systémami, inými PLC, alebo nadradenými systémami riadenia
d) Na priame napájanie externých senzorov a aktuátorov
14. Ktorý typ PLC je najvhodnejší pre jednoduché automatizačné úlohy, ako napríklad riadenie osvetľovacích systémov alebo malých dopravníkov?
a) Rackové PLC
b) Mikro PLC alebo malé kompaktné PLC
c) Modulárne PLC s vysokým počtom I/O
d) Distribuované PLC systémy
15. Ktorý komunikačný protokol sa často používa v moderných PLC pre priemyselnú komunikáciu, najmä cez Ethernet?
a) HTTP (Hypertext Transfer Protocol)
b) FTP (File Transfer Protocol)
c) Modbus TCP alebo Profinet
d) SMTP (Simple Mail Transfer Protocol)
Správne odpovede:
1. b)
2. b)
3. b)
4. b)
5. b)
6. b)
7. a)
8. a)
9. b)
10. b)
11. c)
12. b)
13. c)
14. b)
15. c)
        `;
        const testRegulatoryARiadiaceSystemy = `
Test: Regulátory a riadiace systémy
1. Čo je hlavnou úlohou regulátora v regulačnom obvode?
a) Meria teplotu okolia
b) Porovnáva aktuálnu hodnotu regulovanej veličiny so žiadanou hodnotou a generuje akčnú veličinu
c) Vytvára spätnoväzbový signál pre senzor
d) Zosilňuje signál z aktuátora
2. Ktorá veličina predstavuje žiadaný (požadovaný) stav systému v regulačnom obvode?
a) Výstupná veličina (y)
b) Akčná veličina (u)
c) Referenčná hodnota (w) alebo žiadaná hodnota
d) Poruchová veličina (z)
3. Ako sa označuje regulačná odchýlka (rozdiel medzi žiadanou a skutočnou hodnotou)?
a) e(t)
b) u(t)
c) y(t)
d) w(t)
4. Ktorý člen regulačného obvodu porovnáva referenčný signál a výstupný (spätnoväzbový) signál?
a) Akčný člen (aktuátor)
b) Porovnávací člen (sumátor, komparátor)
c) Snímač (senzor)
d) Regulovaná sústava
5. Čo predstavuje akčná veličina (regulačný signál) v regulačnom obvode?
a) Snímaný údaj o teplote alebo tlaku
b) Výstup z regulátora, ktorý priamo ovplyvňuje regulovanú sústavu cez akčný člen
c) Výsledný výstup celého regulovaného systému
d) Hodnota nastavovaná operátorom na paneli
6. Ktorý signál v uzavretom regulačnom obvode predstavuje informáciu o aktuálnom stave regulovanej veličiny?
a) Akčný signál
b) Spätnoväzbový signál (meraný výstup)
c) Referenčný signál
d) Poruchový signál
7. Čo primárne spôsobuje vznik regulačnej odchýlky?
a) Stabilita systému
b) Rozdiel medzi žiadanou a aktuálnou hodnotou regulovanej veličiny
c) Rýchlosť odozvy akčného člena
d) Presnosť snímača
8. Aká je základná funkcia PID regulátora?
a) Stabilizovať napájacie napätie pre senzory
b) Merať tlak a prietok v potrubí
c) Minimalizovať regulačnú odchýlku kombináciou proporcionálnej, integračnej a derivačnej zložky
d) Generovať náhodné testovacie signály pre systém
9. Čo znamená pojem "ustálený stav" regulovanej veličiny?
a) Stav, kedy je systém vypnutý
b) Dynamický stav, kedy sa veličina rýchlo mení
c) Stav, v ktorom sa regulovaná veličina po určitom čase už nemení alebo osciluje okolo konštantnej hodnoty
d) Stav poruchy, kedy regulátor prestane fungovať
10. Ktorý typ regulátora primárne pracuje s akumulovanou (sčítanou) chybou v čase na odstránenie trvalej regulačnej odchýlky?
a) P-regulátor (Proporcionálny)
b) I-regulátor (Integračný)
c) D-regulátor (Derivačný)
d) On-Off regulátor
11. Ktorý typ pokročilej regulácie využíva matematický model systému na predikciu jeho budúceho správania a optimalizáciu riadiacich zásahov?
a) Fuzzy regulátor
b) Model Predictive Control (MPC)
c) PID regulátor s autotuningom
d) Kaskádová regulácia
12. Čo je charakteristické pre priamy regulátor (direct-acting controller)?
a) Neovplyvňuje priamo vstup do regulovanej sústavy
b) Reaguje len na výstup zo snímača bez porovnania so žiadanou hodnotou
c) Jeho výstup (akčná veličina) priamo pôsobí na vstupný signál regulovanej sústavy alebo akčného člena
d) Používa sa len pre systémy bez spätnej väzby
13. Čo je typické pre nespojitú (diskrétnu) reguláciu?
a) Akčná veličina nadobúda plynulé hodnoty v celom rozsahu
b) Akčná veličina nadobúda len konečný počet diskrétnych hodnôt (napr. zapnuté/vypnuté)
c) Využíva len analógové snímače a aktuátory
d) Je vhodná len pre veľmi pomalé procesy
14. Aký typ regulátora reaguje na rýchlosť zmeny chyby, čím predchádza prekmitom a zlepšuje dynamiku?
a) D-regulátor (Derivačný)
b) I-regulátor (Integračný)
c) P-regulátor (Proporcionálny)
d) PI regulátor (Proporcionálno-integračný)
15. Ktorý regulátor je najvhodnejší pre systémy s výrazne sa meniacimi parametrami alebo neznámou dynamikou, kde sa regulátor sám prispôsobuje?
a) On-Off regulátor
b) Adaptívny regulátor
c) Pevne nastavený PID regulátor
d) Regulátor s pevnou štruktúrou
16. Čo znamená výstupný signál (regulovaná veličina y(t)) v regulačnom obvode?
a) Riadi vstup do regulátora
b) Indikuje veľkosť regulačnej odchýlky
c) Reprezentuje aktuálny meraný stav regulovanej sústavy
d) Je to vždy konštantná hodnota
17. Ktorý typ regulátora využíva lingvistické pravidlá typu "AK (podmienka) POTOM (akcia)" na svoje rozhodovanie?
a) PID regulátor
b) Fuzzy regulátor
c) MPC regulátor
d) Optimálny regulátor
18. Čo zabezpečuje spätnoväzbový signál v uzavretom regulačnom obvode?
a) Priamy vstup energie do systému
b) Ovládanie napájania snímača
c) Informáciu o aktuálnom výstupe systému, ktorá sa vracia na porovnanie so žiadanou hodnotou
d) Generovanie poruchových veličín
19. Čo znamená priamy zásah regulátora do systému v kontexte generovania akčnej veličiny?
a) Regulátor neovplyvňuje výstup systému
b) Akčná veličina je generovaná na základe regulačnej odchýlky (rozdielu w-y)
c) Regulátor je úplne nezávislý od meraného výstupu
d) Akčná veličina je vždy konštantná
20. Aký typ signálu má typicky akčná veličina pri spojitej regulácii?
a) Digitálny (diskrétne úrovne)
b) Pulzný (séria impulzov)
c) Spojitý (analógový, môže nadobúdať ľubovoľnú hodnotu v rozsahu)
d) Binárny (len dve úrovne)
Správne odpovede:
1. b)
2. c)
3. a)
4. b)
5. b)
6. b)
7. b)
8. c)
9. c)
10. b)
11. b)
12. c)
13. b)
14. a)
15. b)
16. c)
17. b)
18. c)
19. b)
20. c)
        `;
        const testRiadenieRegulaciaSnimace20 = `
Test: Riadenie a regulácia, snímače a informácie
1. Čo je úlohou snímača v regulačnom obvode?
a) Generovať výstupný signál pre aktuátor
b) Meria aktuálny stav regulovanej veličiny a premieňa ho na signál
c) Ovláda priamo akčný člen na základe žiadanej hodnoty
d) Filtrovať šum z napájacieho zdroja
2. Ktorý člen regulačného obvodu primárne porovnáva aktuálnu hodnotu regulovanej veličiny (zo spätnej väzby) s jej žiadanou hodnotou?
a) Snímač (senzor)
b) Akčný člen (aktuátor)
c) Regulátor (jeho porovnávacia časť)
d) Regulovaná sústava
3. Čo je referenčná hodnota (žiadaná hodnota, w) v regulačnom obvode?
a) Skutočný nameraný výstup systému
b) Požadovaná hodnota regulovanej veličiny, ktorú má systém dosiahnuť alebo udržiavať
c) Vstupný signál do snímača
d) Maximálna povolená odchýlka systému
4. Aká je hlavná úloha spätnoväzbového obvodu v uzavretej regulačnej slučke?
a) Generovať náhodné poruchy pre testovanie robustnosti systému
b) Merať oneskorenie v prenose signálu
c) Získať informáciu o aktuálnom stave výstupnej veličiny systému a vrátiť ju na vstup regulátora na porovnanie
d) Zosilniť akčnú veličinu pred jej privedením do sústavy
5. Čo vyjadruje prenosová funkcia lineárneho časovo-invariantného systému?
a) Vzťah medzi vstupom a výstupom systému v časovej oblasti, typicky ako diferenciálna rovnica
b) Pomer Laplaceovej transformácie výstupného signálu k Laplaceovej transformácii vstupného signálu pri nulových začiatočných podmienkach
c) Napäťový rozdiel medzi vstupom a výstupom systému
d) Frekvenčnú charakteristiku šumu v systéme
6. Ktorý člen v PID regulátore reaguje na rýchlosť zmeny regulačnej odchýlky a pomáha tak predvídať budúce odchýlky a tlmiť kmity?
a) Proporcionálny (P) člen
b) Derivačný (D) člen
c) Integračný (I) člen
d) Sumačný člen
7. Čo vyjadruje časová odozva systému (napr. prechodová charakteristika)?
a) Zmenu frekvencie výstupného signálu v závislosti od vstupnej frekvencie
b) Odozvu (správanie výstupu) systému v čase na definovaný vstupný signál (napr. skokový alebo impulzný)
c) Ustálený stav výstupu systému pri konštantnom vstupe
d) Maximálnu amplitúdu výstupného signálu
8. Aký je hlavný cieľ identifikácie sústavy v teórii automatického riadenia?
a) Odstrániť všetky poruchy zo systému
b) Vytvoriť čo najpresnejší matematický model dynamického správania reálnej sústavy
c) Nahradiť existujúci regulátor novším modelom
d) Zvýšiť napájacie napätie systému pre vyšší výkon
9. Ktorý snímač teploty využíva termoelektrický jav, pri ktorom vzniká napätie na spoji dvoch rôznych kovov v závislosti od teploty?
a) Termistor (NTC alebo PTC)
b) Termočlánok (Thermocouple)
c) Odporový teplomer (RTD - napr. Pt100)
d) Infračervený pyrometer
10. Ktoré z nasledujúcich sú typicky odporové snímače teploty, ktorých odpor sa mení s teplotou?
a) RTD (napr. Pt100) a termistor (NTC/PTC)
b) Termočlánok a infračervený senzor
c) Piezoelektrický senzor a optický senzor teploty
d) Hallov snímač a kapacitný snímač teploty
11. Čo je charakteristickou výhodou MEMS (Micro-Electro-Mechanical Systems) senzorov?
a) Sú lacné, ale majú veľké rozmery a vysokú spotrebu
b) Majú veľké rozmery, ale sú extrémne presné
c) Malé rozmery, nízka spotreba, možnosť integrácie s elektronikou, často nižšia cena pri veľkosériovej výrobe
d) Sú vhodné len na meranie mechanických veličín
12. Ktorý typ snímača je najvhodnejší na bezkontaktné meranie teploty povrchu objektov?
a) Termistor
b) Infračervený snímač (pyrometer)
c) RTD (Pt100)
d) Termočlánok typu K
13. Čo meria Hallov snímač?
a) Intenzitu zvuku alebo ultrazvuku
b) Tlak kvapaliny alebo plynu
c) Veľkosť a polaritu magnetického poľa, prípadne prítomnosť magnetu
d) Úroveň osvetlenia alebo farbu svetla
14. Ktorý snímač otáčok typicky využíva prerušovanie svetelného lúča alebo odraz svetla od značiek na rotujúcom objekte?
a) Magnetický indukčný snímač
b) Akustický snímač otáčok
c) Optický enkodér alebo optický snímač otáčok
d) Kapacitný snímač otáčok
15. Čo zabezpečuje prevodník A/D (Analógovo-Digitálny prevodník)?
a) Prevod digitálneho signálu na analógový signál
b) Prevod spojitého analógového signálu na diskrétny digitálny signál (kód)
c) Zosilnenie analógového signálu na požadovanú úroveň
d) Filtráciu vysokofrekvenčného šumu z analógového signálu
16. Ktorý komunikačný protokol je ľahký, založený na princípe publikovania/odberu (publish/subscribe) a často sa používa pre IoT aplikácie?
a) Profinet IO
b) Modbus RTU
c) MQTT (Message Queuing Telemetry Transport)
d) Ethernet/IP
17. Ktoré vlastnosti sú najdôležitejšie pri výbere snímača pre konkrétnu aplikáciu?
a) Len cena a fyzická veľkosť snímača
b) Presnosť, rozsah merania, spoľahlivosť, rýchlosť odozvy, odolnosť voči prostrediu, cena
c) Farba krytu snímača a materiál, z ktorého je vyrobený
d) Počet výstupných pinov a typ konektora
18. Ktorý typ regulácie využíva explicitný matematický model procesu na predikciu jeho budúceho správania a optimalizáciu riadiacich vstupov na určitom horizonte?
a) PID regulácia
b) Adaptívna regulácia
c) Model Predictive Control (MPC)
d) Fuzzy regulácia
19. Ktorý snímač tlaku je založený na zmene elektrického odporu materiálu (napr. tenzometra) vplyvom jeho deformácie spôsobenej tlakom?
a) Piezoelektrický snímač tlaku
b) Kapacitný snímač tlaku
c) Odporový snímač tlaku (napr. tenzometrický)
d) Optický snímač tlaku
20. Aký je princíp paralelného spojenia dvoch blokov s prenosovými funkciami G1(s) a G2(s) v blokovej algebre?
a) Výsledný prenos je súčinom G1(s) * G2(s)
b) Výsledný prenos je súčtom G1(s) + G2(s)
c) Výsledný prenos je rozdielom G1(s) - G2(s)
d) Výsledný prenos je G1(s) / (1 + G1(s)G2(s))
Správne odpovede:
1. b)
2. c)
3. b)
4. c)
5. b)
6. b)
7. b)
8. b)
9. b)
10. a)
11. c)
12. b)
13. c)
14. c)
15. b)
16. c)
17. b)
18. c)
19. c)
20. b)
        `;
        const testRiadenieVykonu = `
Test: Riadenie výkonu a výkonové polovodiče
1. Čo je hlavnou funkciou tyristora v obvodoch riadenia výkonu?
a) Generuje vysokofrekvenčné signály pre komunikáciu
b) Riadi napätie v jednosmerných obvodoch ako lineárny regulátor
c) Prepína medzi vodivým (zapnutým) a nevodivým (vypnutým) stavom, čím umožňuje riadiť tok prúdu
d) Zosilňuje malé riadiace signály na ovládanie motorov
2. Ako sa líši triak od tyristora z hľadiska vedenia prúdu?
a) Triak vedie prúd len v jednom smere, tyristor v oboch
b) Triak môže viesť prúd v oboch smeroch striedavého prúdu, zatiaľ čo tyristor typicky len v jednom
c) Triak je menší a rýchlejší ako tyristor
d) Triak nepotrebuje riadiaci signál na zopnutie, tyristor áno
3. Kedy sa diak prepne do vodivého stavu?
a) Pri poklese prúdu pod určitú hranicu
b) Pri prekročení jeho prierazného (spínacieho) napätia v ktoromkoľvek smere
c) Po privedení spúšťacieho impulzu na riadiacu elektródu
d) Len pri zahriatí na určitú teplotu
4. Čo určuje riadiaci uhol (uhol zopnutia) tyristora v obvode so striedavým napätím?
a) Maximálne napätie, ktoré tyristor znesie
b) Okamih v perióde striedavého napätia, kedy je tyristor zopnutý riadiacim impulzom, čím sa reguluje priemerný výkon dodávaný do záťaže
c) Frekvenciu spínania tyristora
d) Teplotu, pri ktorej tyristor optimálne pracuje
5. Čo je typické pre PWM (Pulse Width Modulation) usmerňovače alebo meniče?
a) Používajú mechanické spínače na reguláciu výkonu
b) Riadenie výkonu sa dosahuje zmenou šírky spínacích impulzov pri konštantnej frekvencii
c) Nemajú žiadne riadenie, výstup je priamo úmerný vstupu
d) Sú vhodné len pre veľmi nízke výkony
6. Aká je hlavná výhoda fázovo riadených usmerňovačov (napr. s tyristormi)?
a) Možnosť plynulej regulácie výstupného jednosmerného napätia (a tým aj výkonu) zmenou uhla zopnutia tyristorov
b) Menšia spotreba energie v porovnaní s diódovými usmerňovačmi
c) Vedenie prúdu len jedným smerom, čo zjednodušuje filtráciu
d) Generovanie dokonale hladkého jednosmerného napätia
7. Na čo sa používa dvojimpulzový mostíkový usmerňovač (napr. Graetzov mostík s tyristormi)?
a) Na zmenu frekvencie striedavého prúdu
b) Na plnovlnné usmernenie striedavého prúdu s možnosťou riadenia výstupného napätia
c) Na stabilizáciu teploty výkonových polovodičov
d) Na generovanie vysokonapäťových impulzov
8. Ktorý z uvedených výkonových prvkov umožňuje spínanie a riadenie prúdu v oboch smeroch striedavého prúdu?
a) Tyristor (SCR)
b) Triak
c) Diak (bez riadiacej elektródy)
d) Výkonová dióda
9. Ktoré zariadenie z nasledujúcich má najjednoduchšiu štruktúru a slúži ako spúšťací prvok pre triaky alebo tyristory?
a) Tyristor
b) Triak
c) Diak
d) IGBT
10. Aký je hlavný účel riadeného usmerňovača?
a) Ukladanie elektrickej energie do kondenzátorov
b) Premena striedavého napätia na jednosmerné s možnosťou regulácie úrovne výstupného napätia alebo prúdu
c) Meranie okamžitej hodnoty striedavého prúdu
d) Ochrana obvodu pred prepätím
Správne odpovede
1. c)
2. b)
3. b)
4. b)
5. b)
6. a)
7. b)
8. b)
9. c)
10. b)
        `;
        const testStatickeADynamickeVlastnostiRO = `
Test: Statické a dynamické vlastnosti regulačných obvodov
1. Čo je regulačný obvod?
a) Zariadenie na meranie atmosférického tlaku
b) Systém navrhnutý na automatické udržiavanie alebo zmenu stavu procesu podľa požadovaných hodnôt
c) Obvod na generovanie vysokofrekvenčného striedavého napätia
d) Pasívny filter na potlačenie šumu
2. Aký typ regulačného obvodu nevyužíva spätnú väzbu na korekciu svojho výstupu?
a) Uzavretý regulačný obvod
b) Otvorený regulačný obvod (riadenie v otvorenej slučke)
c) Adaptívny regulačný obvod
d) Kaskádový regulačný obvod
3. Aký je hlavný rozdiel medzi uzavretým a otvoreným regulačným obvodom?
a) Počet vstupných signálov do systému
b) Prítomnosť (uzavretý) alebo absencia (otvorený) spätnej väzby, ktorá porovnáva skutočný výstup so žiadaným
c) Použitie elektrického napätia oproti pneumatickému riadeniu
d) Rýchlosť odozvy systému na zmenu vstupu
4. Aké sú základné časti typického uzavretého regulačného obvodu?
a) Zdroj napájania, prepojovací kábel, LED indikátor
b) Snímač (senzor), regulátor, akčný člen (aktuátor), regulovaná sústava a spätná väzba
c) Odpor, kondenzátor, cievka a tranzistor
d) Počítač, monitor, klávesnica a myš
5. Čo popisuje dynamická vlastnosť regulačného obvodu?
a) Spotreba elektrickej energie systému v pokoji
b) Správanie systému v čase ako reakcia na zmeny vstupných signálov alebo porúch
c) Maximálny výkon, ktorý môže transformátor dodať
d) Fyzické rozmery a hmotnosť regulátora
6. Čo označuje doba ustálenia (settling time) v kontexte časovej odozvy systému?
a) Čas potrebný na úplné spustenie systému z vypnutého stavu
b) Čas potrebný na to, aby sa výstup systému po skokovej zmene vstupu ustálil v blízkosti svojej novej konečnej hodnoty (v rámci definovanej tolerancie)
c) Celkové trvanie jedného riadiaceho signálu
d) Čas, za ktorý sa systém prehreje pri maximálnom zaťažení
7. Čo je regulačná odchýlka (error signal)?
a) Rozdiel medzi požadovanou hodnotou (referenciou) a skutočnou nameranou hodnotou regulovanej veličiny
b) Dĺžka prepojovacieho vedenia medzi snímačom a regulátorom
c) Veľkosť prúdu pretekajúceho akčným členom
d) Frekvencia oscilácií v systéme
8. Čo je hlavným cieľom regulácie v automatickom riadení?
a) Maximalizovať amplitúdu výstupného signálu
b) Minimalizovať regulačnú odchýlku a udržať regulovanú veličinu čo najbližšie k žiadanej hodnote
c) Zvýšiť napájacie napätie systému pre rýchlejšiu odozvu
d) Generovať čo najviac šumu na otestovanie odolnosti
9. Čo popisuje prenosová funkcia lineárneho časovo-invariantného systému?
a) Vzťah medzi dvoma fyzicky oddelenými obvodmi
b) Matematický vzťah (v Laplaceovej transformácii) medzi výstupom a vstupom systému, charakterizujúci jeho dynamické vlastnosti
c) Tepelný odpor materiálu použitého v regulátore
d) Účinnosť premeny energie v akčnom člene
10. Aký typ obvodu reaguje priebežne a plynulo na zmeny vstupných signálov?
a) Systém s nespojitým (napr. dvojpolohovým) riadením
b) Systém so spojitým (analógovým alebo digitálnym s vysokým rozlíšením) riadením
c) Uzavretý obvod bez akčného člena
d) Otvorený obvod bez snímača
11. Čo je charakteristické pre nelineárne regulačné obvody?
a) Ich správanie je vždy nezávislé od amplitúdy vstupných signálov
b) Vždy produkujú rovnaký tvar výstupného signálu ako vstupný
c) Ich dynamické vlastnosti (napr. zosilnenie, časová konštanta) sa menia v závislosti od pracovného bodu alebo amplitúdy signálu
d) Sú vždy stabilnejšie ako lineárne obvody
12. Ktorá vlastnosť patrí medzi statické vlastnosti regulačného obvodu (charakterizuje správanie v ustálenom stave)?
a) Prenosová funkcia v komplexnej rovine
b) Statická presnosť (napr. trvalá regulačná odchýlka) alebo statické zosilnenie
c) Doba ustálenia a prekmit
d) Frekvenčná charakteristika (amplitúdová a fázová)
13. Čo je rušivá imunita (odolnosť voči poruchám) regulačného systému?
a) Schopnosť systému zvýšiť svoje napájacie napätie
b) Schopnosť systému odolávať vplyvu vonkajších alebo vnútorných poruchových veličín a minimalizovať ich dopad na regulovanú veličinu
c) Vstupná impedancia regulátora
d) Maximálna frekvencia, pri ktorej systém ešte správne funguje
14. Ako sa typicky hodnotí kvalita regulačného obvodu?
a) Podľa farby a dizajnu jeho súčiastok
b) Podľa dĺžky použitých prepojovacích káblov
c) Podľa dynamických vlastností (rýchlosť odozvy, prekmit, doba ustálenia) a statických vlastností (presnosť v ustálenom stave)
d) Podľa počtu použitých tranzistorov
15. Čo je stabilita regulačného obvodu?
a) Schopnosť systému rýchlo meniť svoj výstup podľa potreby
b) Schopnosť systému vrátiť sa do rovnovážneho (ustáleného) stavu po pôsobení poruchy alebo zmene vstupu, bez trvalých oscilácií alebo divergencie
c) Množstvo výstupného signálu, ktoré dokáže dodať akčný člen
d) Fyzická odolnosť komponentov voči mechanickému poškodeniu
Správne odpovede:
1. b)
2. b)
3. b)
4. b)
5. b)
6. b)
7. a)
8. b)
9. b)
10. b)
11. c)
12. b)
13. b)
14. c)
15. b)
        `;
        const testZosilnovace = `
Test: Zosilňovače
1. Ktorý typ zosilňovača je primárne určený na zväčšenie amplitúdy napätia vstupného signálu?
a) Výkonový zosilňovač
b) Prúdový zosilňovač
c) Napäťový zosilňovač
d) Diferenciálny zosilňovač
2. Aká trieda zosilňovača má teoreticky najvyššiu kvalitu signálu (najmenšie skreslenie), ale zároveň najnižšiu energetickú účinnosť (často okolo 25-50%)?
a) Trieda A
b) Trieda B
c) Trieda C
d) Trieda D
3. Čo vyjadruje zosilnenie (zisk) zosilňovača?
a) Rozdiel medzi výstupným a vstupným signálom
b) Súčet výstupného a vstupného signálu
c) Pomer amplitúdy (alebo výkonu) výstupného signálu k amplitúde (alebo výkonu) vstupnému signálu
d) Frekvenciu, pri ktorej zosilňovač prestáva pracovať
4. Aký druh skreslenia vzniká v zosilňovačoch triedy B pri prechode signálu nulovou úrovňou, spôsobený tým, že tranzistory potrebujú určité prahové napätie na otvorenie?
a) Fázové skreslenie
b) Prechodové skreslenie (Crossover distortion)
c) Nelineárne harmonické skreslenie
d) Intermodulačné skreslenie
5. Čo zobrazuje amplitúdová prevodová charakteristika zosilňovača?
a) Zmenu fázy výstupného signálu voči vstupnému v závislosti od frekvencie
b) Závislosť amplitúdy výstupného signálu od amplitúdy vstupného signálu
c) Zisk zosilňovača v závislosti od teploty
d) Šumové číslo zosilňovača
6. Čo je hlavným prínosom zavedenia zápornej spätnej väzby v zosilňovači?
a) Výrazné zvýšenie celkového zosilnenia
b) Zvýšenie nelineárneho skreslenia signálu
c) Zlepšenie stability, zníženie skreslenia, rozšírenie frekvenčného pásma, úprava vstupnej a výstupnej impedancie
d) Zúženie frekvenčného pásma pre lepšiu selektivitu
7. Čo charakterizuje ideálny operačný zosilňovač (OZ)?
a) Nízke vstupné impedancie a vysokú výstupnú impedanciu
b) Konečné zosilnenie v otvorenej slučke a obmedzenú šírku pásma
c) Nekonečné zosilnenie v otvorenej slučke, nekonečnú vstupnú impedanciu, nulovú výstupnú impedanciu a nekonečnú šírku pásma
d) Jeden vstup a dva komplementárne výstupy
8. Ktoré základné zapojenie operačného zosilňovača má výstupný signál ako vážený súčet (alebo rozdiel, ak sú vstupné odpory rôzne a niektoré vstupy sú invertujúce) viacerých vstupných signálov?
a) Sčítač (Summing amplifier) alebo Odčítavač (Differential amplifier)
b) Integrátor
c) Derivátor
d) Komparátor
9. Aké napäťové zosilnenie v otvorenej slučke (bez spätnej väzby) má ideálny operačný zosilňovač?
a) 0 dB (teda zosilnenie 1)
b) Veľmi malé, blízke nule
c) Nekonečné
d) Presne 100
10. Ako sa nazýva základné zapojenie operačného zosilňovača, kde vstupný signál je privedený na invertujúci vstup (-) cez rezistor a neinvertujúci vstup (+) je pripojený na zem?
a) Neinvertujúci zosilňovač
b) Invertujúci zosilňovač
c) Sledovač napätia (Voltage follower)
d) Diferenciálny zosilňovač
Správne odpovede:
1. c)
2. a)
3. c)
4. b)
5. b)
6. c)
7. c)
8. a)
9. c)
10. b)
        `;

        const elektrotechnikaTestContentsHudecova = [ 
            testAkcneCleny, testPLC15Otazok, testRegulatoryARiadiaceSystemy,
            testRiadenieRegulaciaSnimace20, testRiadenieVykonu,
            testStatickeADynamickeVlastnostiRO, testZosilnovace
        ];

        // --- Test Data (Nová sekcia Mechanika Elektrotechnika) ---
        const testRobotikaZaklady = `
Test: Základy Robotiky (HUDECOVÁ)
1. Čo je hlavným cieľom robotiky?
a) Nahrádzať ľudskú prácu vo všetkých oblastiach
b) Vytvárať zariadenia schopné vykonávať úlohy efektívne, presne a autonómne
c) Vyvíjať len humanoidné roboty
d) Zvyšovať nezamestnanosť
e) Minimalizovať náklady na energie
f) Vyvíjať len stacionárne roboty
2. Ktorý pojem označuje koncový nástroj robota, ktorý vykonáva konkrétnu úlohu?
a) Manipulátor
b) Senzor
c) Efektor
d) Pohon
e) Kĺb
f) Základňa
3. Aký je hlavný rozdiel medzi doprednou a inverznou kinematikou?
a) Dopredná určuje sily, inverzná pohyb
b) Dopredná počíta polohu efektora z uhlov kĺbov, inverzná počíta uhly kĺbov pre danú polohu efektora
c) Dopredná sa používa pre sériové roboty, inverzná pre paralelné
d) Dopredná je jednoduchšia na výpočet ako inverzná
e) Inverzná kinematika sa zaoberá len rýchlosťou
f) Dopredná kinematika zohľadňuje hmotnosť segmentov
4. Aké sú tri hlavné kategórie robotov podľa oblasti použitia?
a) Priemyselné, servisné, vesmírne
b) Domáce, vojenské, podvodné
c) Priemyselné, servisné, vojenské (alebo prieskumné/zábavné)
d) Stavebné, poľnohospodárske, dopravné
e) Mikroroboty, nanoroboty, makroroboty
f) Humanoidné, zvieracie, kolesové
5. Čo sú to manuálne, autonómne a semi-autonómne roboty?
a) Manuálne sú ovládané hlasom, autonómne myslia samé, semi-autonómne sú na diaľkové ovládanie
b) Manuálne vyžadujú priamu kontrolu človekom, autonómne vykonávajú úlohy samostatne na základe algoritmov a senzorických vstupov, semi-autonómne kombinujú oba prístupy
c) Manuálne sú len mechanické, autonómne majú AI, semi-autonómne sú programovateľné len v assembleri
d) Manuálne nemajú senzory, autonómne majú veľa senzorov, semi-autonómne majú len kameru
e) Manuálne sú lacné, autonómne drahé, semi-autonómne stredne drahé
f) Manuálne pracujú pomaly, autonómne rýchlo, semi-autonómne podľa potreby
Správne odpovede:
1. b)
2. c)
3. b)
4. c)
5. b)
`;
        const novaMechanikaElektrotechnikaTestContents = [
            testRobotikaZaklady
        ];

        // --- Test Data (Nová sekcia Ekonomika) ---
        const testEkonomikaZaklady = `
Test: Základy podnikania a ekonomiky
1. Čo patrí medzi základné právne náležitosti pri založení podniku?
a) Výber loga a marketingová stratégia
b) Výber vhodnej právnej formy, zakladateľská listina/zmluva, živnostenské oprávnenie
c) Nábor zamestnancov a prieskum trhu
d) Zabezpečenie kancelárskych priestorov a vybavenia
e) Vytvorenie webovej stránky a profilov na sociálnych sieťach
f) Analýza konkurencie a stanovenie cien
2. Ktorá právna forma podniku je na Slovensku najčastejšia a vyžaduje minimálne základné imanie 5 000 €?
a) Verejná obchodná spoločnosť
b) Akciová spoločnosť (a.s.)
c) Spoločnosť s ručením obmedzeným (s.r.o.)
d) Komanditná spoločnosť
e) Družstvo
f) Samostatne hospodáriaci roľník
3. Čo zahŕňa hmotný majetok podniku?
a) Softvér, patenty, goodwill, licencie
b) Stroje, budovy, pozemky, dopravné prostriedky
c) Cenné papiere, podiely v iných firmách, pohľadávky
d) Finančná hotovosť, bankové účty, krátkodobé investície
e) Zamestnanci, know-how, zákaznícka databáza
f) Zásoby materiálu a hotových výrobkov
4. Aký je rozdiel medzi fyzickým a morálnym opotrebovaním majetku?
a) Fyzické je spôsobené používaním a časom, morálne technologickým pokrokom a zmenou dopytu
b) Fyzické sa týka len strojov, morálne budov a pozemkov
c) Fyzické je viditeľné poškodenie, morálne je len účtovný pojem
d) Fyzické opotrebenie znižuje hodnotu, morálne ju zvyšuje
e) Morálne opotrebenie sa týka len nehmotného majetku
f) Fyzické opotrebenie je plánované, morálne je náhodné
5. Čo sú výnosy podniku?
a) Spotreba výrobných činiteľov vyjadrená v peňažných jednotkách
b) Výsledky činnosti podniku vo fyzických jednotkách (napr. počet výrobkov)
c) Peňažné príjmy z predaja výrobkov, služieb, tovaru, prípadne iné finančné prínosy
d) Súčet všetkých nákladov a zisku podniku
e) Hodnota majetku, ktorý podnik vlastní
f) Peniaze, ktoré podnik dlhuje svojim dodávateľom
6. Aký je hlavný účel sociálneho poistenia?
a) Zabezpečiť úhradu zdravotnej starostlivosti pre všetkých občanov
b) Poskytovať finančnú pomoc a zabezpečenie občanom v určitých životných situáciách (napr. dôchodok, nemoc, materstvo, nezamestnanosť)
c) Kryť škody na majetku podniku spôsobené živelnými pohromami
d) Financovať vzdelávacie a kultúrne aktivity v štáte
e) Zabezpečiť obranu a bezpečnosť krajiny
f) Podporovať rozvoj infraštruktúry a verejných služieb
7. Čo znamená pojem "likvidita" podniku?
a) Schopnosť podniku dosahovať dlhodobý zisk a rast
b) Schopnosť podniku včas uhrádzať svoje splatné krátkodobé záväzky
c) Celkové množstvo hotovosti a bankových vkladov, ktoré má podnik k dispozícii
d) Rýchlosť, akou sa zásoby podniku premieňajú na tržby
e) Miera zadlženosti podniku voči externým veriteľom
f) Efektívnosť, s akou podnik využíva svoj majetok na generovanie tržieb
8. Aký je hlavný rozdiel medzi časovou a úkolovou mzdou?
a) Časová mzda závisí od odpracovaného času, úkolová od množstva vykonanej práce (napr. počtu výrobkov)
b) Časová mzda je vždy nižšia ako úkolová mzda
c) Časovú mzdu dostávajú len manažéri, úkolovú mzdu výrobný personál
d) Úkolová mzda zahŕňa aj príplatky za nadčasy, časová nie
e) Časová mzda sa vypláca týždenne, úkolová mesačne
f) Úkolová mzda je typická pre služby, časová pre výrobu
9. Čo tvorí národné hospodárstvo?
a) Len štátne podniky, ministerstvá a centrálna banka
b) Všetky ekonomické subjekty (podniky, domácnosti, štát) pôsobiace na území daného štátu a ich vzájomné vzťahy
c) Len súkromné firmy a živnostníci registrovaní v obchodnom registri
d) Medzinárodné korporácie pôsobiace na území štátu
e) Súhrn všetkých prírodných zdrojov a vyrobeného kapitálu v krajine
f) Len sektor služieb a finančný sektor
10. Aká je hlavná funkcia Národnej banky Slovenska (NBS) ako centrálnej banky?
a) Poskytovať komerčné úvery podnikom a obyvateľstvu za najvýhodnejších podmienok
b) Garantovať stabilitu meny, vykonávať menovú politiku a dohľad nad finančným trhom
c) Vyberať dane od všetkých ekonomických subjektov a financovať štátny rozpočet
d) Priamo riadiť činnosť všetkých komerčných bánk na Slovensku
e) Podporovať export slovenských výrobkov do zahraničia
f) Stanovovať ceny základných potravín a energií
Správne odpovede:
1. b)
2. c)
3. b)
4. a)
5. c)
6. b)
7. b)
8. a)
9. b)
10. b)
`;
        const ekonomikaTestContents = [
            testEkonomikaZaklady
        ];


        // --- Test Data (Slovenčina) ---
        const testSlovnaZasobaLiteratura = `
Test: Slovná zásoba a Staroveká literatúra
1. Čo tvorí jadro slovnej zásoby?
a) Odborné termíny a neologizmy
b) Najstaršie a najčastejšie používané slová (napr. zem, voda, otec)
c) Slangové a nárečové slová
2. Ktorý z uvedených pojmov označuje slová s rovnakou podobou, ale odlišným významom (napr. čelo - časť hlavy, čelo - hudobný nástroj)?
a) Synonymá
b) Antonymá
c) Homonymá
3. Ktorý epos je považovaný za najstaršiu literárnu pamiatku a rozpráva príbeh kráľa mesta Uruk, Gilgameša?
a) Ilias
b) Epos o Gilgamešovi
c) Antigona
4. V Sofoklovej tragédii Antigona, kto vydal zákaz pochovať Polyneika, pretože bojoval proti Tébam?
a) Eteokles
b) Haimon
c) Kreon
Správne odpovede:
1. b)
2. c)
3. b)
4. c)
        `;
        const testFrazeologizmusStredovek = `
Test: Frazeologizmus a Staroslovienska literatúra
1. Ktorý typ frazeologizmu je krátky ľudový výrok, z ktorého vyplýva poučenie?
a) Porekadlo
b) Príslovie
c) Pranostika
2. Kto zostavil prvé slovanské písmo, hlaholiku, pred príchodom na Veľkú Moravu?
a) Metod
b) Rastislav
c) Konštantín
3. Ktoré dielo je považované za prvú slovanskú báseň, oslavuje slovanský preklad Písma a vyzdvihuje domáci jazyk?
a) Moravsko-panónske legendy
b) Proglas
c) Život sv. Metoda
4. Aký bol prvý slovanský liturgický (bohoslužobný) jazyk, ktorý Konštantín a Metod priniesli na Veľkú Moravu?
a) Latinčina
b) Gréčtina
c) Staroslovienčina
Správne odpovede:
1. b)
2. c)
3. b)
4. c)
        `;
        const testSyntaxHumanizmus = `
Test: Syntax (vety) a Humanizmus a renesancia
1. Veta "Prší." je podľa členitosti:
a) Dvojčlenná s nevyjadreným podmetom
b) Jednočlenná slovesná
c) Jednočlenná neslovesná
2. Ktoré myšlienkové hnutie kládlo do centra pozornosti človeka a jeho pozemský svet, na rozdiel od stredovekého zamerania na nadpozemský svet?
a) Barok
b) Klasicizmus
c) Humanizmus a renesancia
3. Kto je autorom slávnej tragédie "Hamlet", ktorá zobrazuje boj jednotlivca so svetom intríg a zločinu?
a) Giovanni Boccaccio
b) Francesco Petrarca
c) William Shakespeare
4. Aký typ vety je "Nech sa ti darí!" podľa obsahu (modálnosti)?
a) Oznamovacia
b) Rozkazovacia
c) Želacia
Správne odpovede:
1. b)
2. c)
3. c)
4. c)
        `;
        const testSuvetiaBarok = `
Test: Súvetia, jednoduchá veta a Barok
1. Aký typ priraďovacieho súvetia je "Mama varí, ale neje."?
a) Zlučovacie
b) Odporovacie
c) Vylučovacie
2. Ktorý z nasledujúcich znakov je typický pre barokovú literatúru?
a) Jednoduchosť a strohosť formy
b) Dôraz na rozum a logiku
c) Používanie protikladov a pompéznosť
3. Kto je autorom diela "Valaská škola, mravú stodola", ktoré obsahuje ponaučenia zo života valachov?
a) Matej Bel
b) Ján Simonides
c) Hugolín Gavlovič
4. Aký typ súvetia je "Pochopil, čo treba urobiť."?
a) Priraďovacie zlučovacie
b) Podraďovacie predmetové
c) Podraďovacie podmetové
Správne odpovede:
1. b)
2. c)
3. c)
4. b)
        `;
        const testProzodiaKlasicizmus = `
Test: Prozódia a Klasicizmus
1. Čo označuje pojem "kvantita" v prozodických vlastnostiach reči?
a) Sila hlasu
b) Dĺžka trvania hlások
c) Tónové vlnenie hlasu
2. Ktorý z uvedených princípov bol ústredným pre klasicistickú literatúru?
a) Dôraz na cit a fantáziu
b) Napodobňovanie antických vzorov a dôraz na rozum
c) Odmietanie pravidiel a voľnosť tvorby
3. Kto je autorom básnickej skladby "Slávy dcera", ktorá je významným dielom slovenského klasicizmu?
a) Ján Hollý
b) Ján Kollár
c) René Descartés
4. Akú melódiu má zvyčajne oznamovacia veta v slovenčine?
a) Stúpavú
b) Klesavú
c) Nekončiacu (polokadenciu)
Správne odpovede:
1. b)
2. b)
3. b)
4. b)
        `;
        const testPodstatneMenaDrama = `
Test: Podstatné mená a Slovenská dráma do r. 1945
1. Ktoré z nasledujúcich podstatných mien je pomnožné?
a) ľudstvo
b) nohavice
c) Jano
2. Ktorý slovenský dramatik je autorom veselohry "Kocúrkovo alebo Len aby sme v hanbe neostali"?
a) Ján Palárik
b) Jozef Gregor-Tajovský
c) Ján Chalupka
3. V hre Jozefa Gregora-Tajovského "Statky-zmätky", čo je hlavným motívom konania manželov Palčíkovcov?
a) Láska k blížnemu
b) Chamtivosť a túžba po majetku
c) Snaha pomôcť mladým ľuďom
4. Aký rod má podstatné meno "kameň"?
a) Mužský
b) Ženský
c) Stredný
Správne odpovede:
1. b)
2. c)
3. b)
4. a)
        `;
        const testVyvinJazykaRomantizmusSvetovy = `
Test: Vývin slovenského jazyka a Svetový romantizmus
1. Na základe akého nárečia kodifikoval Anton Bernolák spisovnú slovenčinu v roku 1787?
a) Stredoslovenského nárečia
b) Východoslovenského nárečia
c) Kultúrnej západoslovenčiny (trnavského typu)
2. Ktorý z uvedených autorov je predstaviteľom nemeckého romantizmu a napísal román "Utrpenie mladého Werthera"?
a) Victor Hugo
b) Johann Wolfgang Goethe
c) George Gordon Byron
3. Čo bolo charakteristickým znakom romantického hrdinu?
a) Podriadenosť spoločenským konvenciám a rozumu
b) Výnimočnosť, osamelosť, túžba po slobode a často tragický osud
c) Snaha o materiálne zbohatnutie a spoločenský postup
4. Ktoré z nasledujúcich diel NIE JE romantickou poémou A. S. Puškina?
a) Kaukazský zajatec
b) Cigáni
c) Babička
Správne odpovede:
1. c)
2. b)
3. b)
4. c)
        `;
        const testKomunikaciaRomantizmusSk = `
Test: Komunikácia a Slovenský romantizmus
1. Aký typ komunikácie prebieha, keď účastníci nie sú v tej istej chvíli na tom istom mieste (napr. cez SMS)?
a) Priama komunikácia
b) Nepriama komunikácia
c) Neverbálna komunikácia
2. Ktorý z nasledujúcich znakov je typický pre slovenský romantizmus?
a) Odmietanie ľudovej slovesnosti ako inšpirácie
b) Dôraz na individualizmus a osobnú slobodu autora nad národnými záujmami
c) Čerpanie námetov z národnej histórie a idealizácia postáv
3. Kto bol vedúcou osobnosťou štúrovskej generácie a kodifikoval spisovnú slovenčinu založenú na stredoslovenskom nárečí?
a) Ján Kollár
b) Samo Chalupka
c) Ľudovít Štúr
4. Aký princíp komunikácie zdôrazňuje potrebu prispôsobiť sa úrovni toho, s kým hovoríme?
a) Princíp zdvorilosti
b) Princíp irónie
c) Princíp kooperácie
Správne odpovede:
1. b)
2. c)
3. c)
4. c)
        `;
        const testPublicistickyStylUmenie = `
Test: Publicistický štýl, Umenie a literatúra
1. Ktorý z nasledujúcich útvarov patrí medzi analytické útvary publicistického štýlu?
a) Správa
b) Komentár
c) Reportáž
2. Ktorá funkcia umenia sa zameriava na poskytovanie príjemného zážitku a rozlišovanie hodnotného od braku?
a) Výchovná funkcia
b) Vzdelávacia funkcia
c) Estetická funkcia
3. Ktorý literárny druh je určený na inscenovanie hercami v divadle a jeho základ tvoria dialógy a monológy?
a) Lyrika
b) Epika
c) Dráma
4. Aký je hlavný cieľ publicistického štýlu?
a) Len zabávať čitateľa
b) Prinášať informácie, poúčať a ovplyvňovať verejnosť
c) Vytvárať umelecké diela s hlbokou filozofickou myšlienkou
Správne odpovede:
1. b)
2. c)
3. c)
4. b)
        `;
        const testSlohovePostupyStur = `
Test: Slohové postupy, útvary a Ľudovít Štúr
1. Ktorý slohový postup zachytáva udalosti (príbeh) chronologicky alebo retrospektívne?
a) Opisný
b) Výkladový
c) Rozprávací (naratívny)
2. V ktorom roku uzákonil Ľudovít Štúr spolu s Hurbanom a Hodžom spisovnú slovenčinu na základe stredoslovenského nárečia?
a) 1787
b) 1843
c) 1852
3. Aký názov niesli noviny, ktoré vydával Ľudovít Štúr a mali literárnu prílohu Orol tatranský?
a) Slovenskje pohladi
b) Slovenskje národňje novini
c) Národňje zpievanki
4. Ktorý slohový útvar je charakteristický pre informačný slohový postup a odpovedá na otázky Čo, kde, kedy? sa stalo?
a) Úvaha
b) Správa
c) Opis pracovnej činnosti
Správne odpovede:
1. c)
2. b)
3. b)
4. b)
        `;
        const testAdministrativnyStylBottoChalupka = `
Test: Administratívny štýl, Botto a Chalupka
1. Ktorý z nasledujúcich znakov NIE JE typický pre administratívny štýl?
a) Vecnosť a presnosť
b) Používanie citovo zafarbených slov
c) Schematickosť a štandardizované frázy
2. Ktorý štúrovský básnik je autorom hrdinskej epickej básne "Mor ho!"?
a) Ján Botto
b) Andrej Sládkovič
c) Samo Chalupka
3. Balada "Žltá ľalia" od Jána Bottu symbolizuje žiarlivosť. Aký trest postihne Evu za nedodržanie sľubu vernosti?
a) Vyhnanstvo z dediny
b) Mŕtvy Adam si ju vezme so sebou
c) Strata všetkého majetku
4. Aký typ hrdinu predstavujú slovanskí poslovia v básni "Mor ho!"?
a) Individuálny hrdina s osobnými problémami
b) Zbabelý hrdina utekajúci pred bojom
c) Kolektívny hrdina, milujúci vlasť a slobodu
Správne odpovede:
1. b)
2. c)
3. b)
4. c)
        `;
        const testOpisSladkovic = `
Test: Opis a Andrej Sládkovič
1. Aký typ opisu sa zameriava na zachytenie objektu v pohybe alebo následnosť činností pri výrobe?
a) Statický opis
b) Dynamický opis
c) Jednoduchý opis
2. Ktorá z básnických skladieb Andreja Sládkoviča je považovaná za najdlhšiu ľúbostnú báseň na svete a venuje sa láske k Márii Pišlovej?
a) Detvan
b) Marína
c) Nehaňte ľud môj
3. V diele "Detvan", do akého pluku vstupuje Martin pod podmienkou, že si môže nechať svoj kroj a fujaru?
a) Cisársky pluk
b) Čierny pluk kráľa Matiáša
c) Jánošíkovská družina
4. Aký je hlavný rozdiel medzi jednoduchým a odborným opisom?
a) Jednoduchý opis používa viac umeleckých prostriedkov
b) Odborný opis využíva odbornú terminológiu a má za cieľ poučiť
c) Jednoduchý opis je vždy subjektívny, odborný vždy objektívny
Správne odpovede:
1. b)
2. b)
3. b)
4. b)
        `;
        const testCharakteristikaRealizmusSvetovy = `
Test: Charakteristika a Svetový realizmus
1. Aký typ charakteristiky opisuje povahové a duševné vlastnosti človeka, jeho záujmy a schopnosti?
a) Vonkajšia charakteristika
b) Vnútorná charakteristika
c) Priama charakteristika
2. Ktorý filozofický smer je základom realizmu a považuje za skutočné len to, čo sa dá overiť rozumom a skúsenosťou?
a) Idealizmus
b) Sentimentalizmus
c) Pozitivizmus
3. Kto je autorom románu "Otec Goriot", ktorý zobrazuje tragický príbeh obetavej otcovskej lásky v spoločnosti ovládanej peniazmi?
a) Charles Dickens
b) Honoré de Balzac
c) Lev Nikolajevič Tolstoj
4. V románe "Zločin a trest" od F. M. Dostojevského, prečo študent Raskoľnikov zabije úžerníčku?
a) Z pomsty za osobnú krivdu
b) Z lúpežných pohnútok
c) Verí, že tým pomôže jej obetiam a "zabije princíp"
Správne odpovede:
1. b)
2. c)
3. b)
4. c)
        `;
        const testSlovZasobaHviezdoslavSladkovic = `
Test: Slovná zásoba, Hviezdoslav a Sládkovič
1. Ktorý typ slovníka vysvetľuje pôvod a vývin jednotlivých slov?
a) Frazeologický slovník
b) Terminologický slovník
c) Etymologický slovník
2. V diele "Hájnikova žena" od P. O. Hviezdoslava, kto zabije Artuša Villániho v sebaobrane?
a) Michal Čajka
b) Hanka Čajková
c) Starý gróf Villáni
3. Aký veršový systém používal Andrej Sládkovič vo svojich dielach ako "Detvan"?
a) Časomerný verš
b) Slabičný (sylabický) verš
c) Voľný verš
4. Čo je hlavným konfliktom v Hviezdoslavovej "Hájnikovej žene"?
a) Konflikt medzi láskou a povinnosťou
b) Rozpor medzi šľachtou a ľudom, ich morálnymi hodnotami
c) Boj človeka s prírodou
Správne odpovede:
1. c)
2. b)
3. b)
4. b)
        `;
        const testJazykoveStylyRealizmusSk = `
Test: Jazykové štýly a Slovenský realizmus
1. Ktorý jazykový štýl sa využíva v súkromnom, neformálnom, hovorenom styku a využíva aj nespisovné slová?
a) Administratívny štýl
b) Hovorový štýl
c) Umelecký štýl
2. Ktorý z uvedených autorov patrí k predstaviteľom slovenského realizmu a napísal dielo "Ťapákovci"?
a) Martin Kukučín
b) Božena Slančíková-Timrava
c) Jozef Gregor-Tajovský
3. Aký je hlavný znak náučného (odborného) štýlu?
a) Subjektívnosť a emotívnosť
b) Presnosť, objektívnosť a používanie odborných termínov
c) Snaha o zaujímavosť a aktuálnosť za každú cenu
4. V diele Martina Kukučína "Keď báčik z Chochoľova umrie", akú spoločenskú vrstvu autor kritizuje?
a) Chudobný dedinský ľud
b) Upadajúce zemianstvo
c) Bohatých mestských obchodníkov
Správne odpovede:
1. b)
2. b)
3. b)
4. b)
        `;
        const testUvahaHronsky = `
Test: Úvaha, Výkladový slohový postup a J. C. Hronský
1. Aký je hlavný rozdiel medzi úvahou a výkladom?
a) Úvaha je vždy kratšia ako výklad.
b) Úvaha vyjadruje subjektívny názor autora, kým výklad sa snaží o objektívnosť a vysvetlenie faktov.
c) Výklad používa umelecké prostriedky, úvaha len odborné termíny.
2. Ktorý logický postup vo výkladovom slohovom postupe ide od konkrétneho k všeobecnému, od známeho k neznámemu?
a) Deduktívny postup
b) Induktívny postup
c) Analytický postup
3. Ktorý román Jozefa Cígera Hronského zachytáva utrpenie jednoduchého dedinského človeka menom Jozef Mak, ktorý čelí ranám osudu?
a) Pisár Gráč
b) Svet na trasovisku
c) Jozef Mak
4. Aký literárny smer charakterizuje román "Jozef Mak" prvkami ako zobrazenie utrpenia a osudovosti?
a) Romantizmus
b) Expresionizmus a fatalizmus
c) Klasicizmus
Správne odpovede:
1. b)
2. b)
3. c)
4. b)
        `;
        const testVetneClenyPrvaSvetova = `
Test: Vetné členy a 1. svetová vojna v literatúre
1. Ktorý z nasledujúcich vetných členov rozvíja podmet, predmet alebo príslovkové určenie vyjadrené podstatným menom a pýtame sa naň otázkami Aký? Ktorý? Čí?
a) Predmet
b) Prívlastok
c) Prísudok
2. V románe Mila Urbana "Živý bič", čo symbolizuje názov prvej časti "Stratené ruky"?
a) Len fyzické zranenia vojakov z vojny
b) Chýbajúce ruky na poliach a zároveň zranenia z vojny
c) Strata nádeje a viery dedinčanov
3. Ktorá postava v novele "Hrdinovia" od B. S. Timravy predstavuje falošné hrdinstvo a vlastenectvo, zatiaľ čo sa sama vyhýba odvodu?
a) Podnotár Štefan Širický
b) Notár Laci Baláň
c) Ilčíčka
4. Akým vetným členom je slovo "ráno" vo vete "Cestuje ráno."?
a) Príslovkové určenie miesta
b) Príslovkové určenie času
c) Príslovkové určenie spôsobu
Správne odpovede:
1. b)
2. b)
3. b)
4. b)
        `;
        const testSlovesaLyrizovanaProza = `
Test: Slovesá a Lyrizovaná próza
1. Ktorá gramatická kategória slovesa vyjadruje, či je dej ukončený alebo neukončený?
a) Čas
b) Spôsob
c) Vid
2. Ktorý z autorov patrí k predstaviteľom prózy naturizmu a napísal novelu "Tri gaštanové kone"?
a) Dobroslav Chrobák
b) Margita Figuli
c) Ľudo Ondrejov
3. Aký typ slovesného tvaru je "robiť"?
a) Činné príčastie prítomné
b) Neurčitok
c) Prechodník
4. V novele Dobroslava Chrobáka "Drak sa vracia", kto je tajomná postava Draka?
a) Skutočný drak s nadprirodzenými schopnosťami
b) Martin Lepiš Madlušovie, hrnčiar opradený záhadami
c) Zbojník, ktorý terorizuje dedinu
Správne odpovede:
1. c)
2. b)
3. b)
4. b)
        `;
        const testDiakritikaInterpunkciaDramaMedzivojnova = `
Test: Diakritika, Interpunkcia a Medzivojnová dráma
1. Ktoré z nasledujúcich znamienok patrí medzi diakritické (rozlišovacie) znamienka?
a) Bodka (.)
b) Mäkčeň (ˇ)
c) Otáznik (?)
2. Ktorý dramatik je autorom tragédie "Bačova žena", kde sa rieši konflikt ženy medzi dvoma mužmi?
a) Július Barč-Ivan
b) Ivan Stodola
c) Peter Zvon
3. Na čo sa používa spojovník (-), na rozdiel od pomlčky (–)?
a) Na oddelenie viet a vsuviek
b) Na vyjadrenie zlučovacieho vzťahu v zložených slovách bez medzier (napr. Gregor-Tajovský)
c) Na označenie nedokončenej výpovede
4. V hre Ivana Stodolu "Jožko Púčik a jeho kariéra", čo autor satirizuje?
a) Byrokraciu a falošne chápaný humanizmus
b) Lásku k peniazom a majetku
c) Politické intrigy v malom meste
Správne odpovede:
1. b)
2. b)
3. b)
4. a)
        `;
        const testZvukovaStrankaSvetovaPo1945 = `
Test: Zvuková stránka jazyka a Svetová literatúra po 1945 (1)
1. Ktorá jazyková disciplína skúma a opisuje tvorenie zvukov reči artikulačnými orgánmi?
a) Fonológia
b) Ortoepia
c) Fonetika
2. Ktorý literárny smer, populárny po 2. svetovej vojne, sa zaoberal existenciou človeka v hraničných situáciách a pocitmi úzkosti?
a) Neorealizmus
b) Existencializmus
c) Magický realizmus
3. Čo je to spodobovanie spoluhlások (znelostná asimilácia)?
a) Predlžovanie samohlások vo vete
b) Prispôsobenie výslovnosti dvoch susedných alebo blízkych hlások podľa znelosti
c) Zmena významu slova pridaním predpony
4. Kto je autorom románu "Kto chytá v žite", ktorý zobrazuje pocity nespokojnej povojnovej generácie?
a) Albert Camus
b) Jerome David Salinger
c) Gabriel Garcia Márquez
Správne odpovede:
1. c)
2. b)
3. b)
4. b)
        `;
        const testRecnickyStylVojnaNeorealizmusSocialReal = `
Test: Rečnícky štýl a Svetová literatúra (vojna, neorealizmus, soc. realizmus)
1. Ktorý znak NIE JE typický pre rečnícky štýl?
a) Ústnosť a verejnosť
b) Snaha o maximálnu objektivitu a vedeckú presnosť
c) Používanie oslovení, rečníckych otázok a mimojazykových prostriedkov
2. Ktorý literárny smer, typický pre povojnové Taliansko, zobrazoval jednoduchých ľudí z vidieka a chudobných štvrtí?
a) Socialistický realizmus
b) Existencializmus
c) Neorealizmus
3. Kto je autorom románu "Doktor Živago", ktorý kriticky zobrazuje udalosti v Rusku počas revolúcií a občianskej vojny?
a) Michail Šolochov
b) Alexander Solženicyn
c) Boris Pasternak
4. Aký je hlavný cieľ agitačných rečníckych prejavov?
a) Informovať a vzdelávať
b) Presviedčať, agitovať a ovplyvňovať
c) Zabávať a vytvárať príjemnú atmosféru
Správne odpovede:
1. b)
2. c)
3. c)
4. b)
        `;
        const testDiskusnyPrispevokSlovPoeziaPo1945 = `
Test: Diskusný príspevok a Slovenská poézia po 1945
1. Čo by malo byť v úvode diskusného príspevku?
a) Podrobné riešenie problému
b) Oslovenie prítomných a nadviazanie na predchádzajúcu diskusiu/prednášku
c) Len poďakovanie za slovo
2. Ktorý slovenský básnik, predstaviteľ tzv. návratovej poézie, napísal zbierku "Moja rodná"?
a) Milan Rúfus
b) Miroslav Válek
c) Ján Kostra
3. Aká je jedna z fáz tvorenia rečníckeho prejavu, pri ktorej si rečník pripravuje a organizuje obsah?
a) Len prednes
b) Výber témy a usporiadanie témy (kompozícia)
c) Len zapamätanie si textu
4. V básni "Jablko" od Miroslava Válka, čo symbolizuje padajúce a nezrelé jablko?
a) Radosť a šťastie v láske
b) Rozpadajúci sa a nezrelý vzťah medzi mužom a ženou
c) Prírodnú katastrofu
Správne odpovede:
1. b)
2. c)
3. b)
4. b)
        `;
        const testRecnickePrejavyJasikBednar = `
Test: Rečnícke prejavy a Slovenská literatúra po 1945 (Jašík, Bednár)
1. Ktorý typ rečníckeho prejavu je napríklad príhovor na stužkovej slávnosti?
a) Agitačný prejav
b) Náučný prejav
c) Príležitostný slávnostný prejav
2. Ktorý slovenský prozaik napísal román "Námestie svätej Alžbety" o tragickej láske Igora a Evy počas riešenia židovskej otázky?
a) Alfonz Bednár
b) Rudolf Jašík
c) Dominik Tatarka
3. V ktorej etape vývoja slovenskej literatúry po roku 1945 dominoval socialistický realizmus a schématizmus?
a) 1945 – 1948
b) 1948 – 1956 (tzv. 50. roky)
c) 1956 – 1969 (tzv. 60. roky)
4. V novele Alfonza Bednára "Kolíska", aký je hlavný morálny odkaz diela?
a) Človek by sa mal vždy prispôsobiť moci, aby prežil.
b) Vojna ospravedlňuje akékoľvek konanie.
c) Človek sa má za každých okolností zachovať čestne a podľa svojho svedomia.
Správne odpovede:
1. c)
2. b)
3. b)
4. c)
        `;
        const testRozpravaciSlohTotalita = `
Test: Rozprávací slohový postup a Literatúra proti totalite
1. Ktorý z nasledujúcich prvkov NIE JE typický pre rozprávací slohový postup?
a) Zachytávanie udalostí v časovej postupnosti (chronologicky alebo retrospektívne)
b) Prevaha podstatných mien a odborných termínov
c) Používanie slovies, priamej reči a stupňovanie deja
2. Ktorý slovenský autor napísal román "Ako chutí moc", kritizujúci deformáciu človeka vplyvom totalitnej moci?
a) Dominik Tatarka
b) Ladislav Mňačko
c) Peter Jaroš
3. Čo znamená pojem "in medias res" v kompozícii rozprávacieho útvaru?
a) Postupný úvod s opisom prostredia a postáv
b) Vpadnutie priamo do deja, bez úvodnej expozície
c) Pohľad späť do minulosti na začiatku príbehu
4. V románe Dominika Tatarku "Démon súhlasu", čo predstavuje hlavný hrdina Bartolomej Boleráz?
a) Odvážneho bojovníka proti totalitnému režimu
b) Človeka, ktorý sa zo strachu prispôsobuje pokrytectvu režimu
c) Spokojného občana veriaceho v ideály socializmu
Správne odpovede:
1. b)
2. b)
3. b)
4. b)
        `;
        const testSlovLitPo1945BallekMitana = `
Test: Slovenská literatúra po 1945 (Ballek, Mitana) a Postmoderna
1. Ktoré umelecké postupy sú typické pre postmodernu?
a) Prísne dodržiavanie žánrových pravidiel a klasických foriem
b) Prelínanie žánrov, paródia, irónia a využívanie citácií
c) Dôraz na originalitu a odmietanie akýchkoľvek starších vzorov
2. Ktorý slovenský autor je známy svojimi dielami z prostredia južného Slovenska, ako napríklad román "Pomocník"?
a) Dušan Mitana
b) Peter Jaroš
c) Ladislav Ballek
3. V románe Ladislava Balleka "Pomocník", aký vplyv má pomocník Volent Lančarič na rodinu mäsiara Riečana?
a) Pomáha im udržať si morálne hodnoty a čestnosť.
b) Jeho vplyvom rodina zbohatne, ale mravne a citovo upadá.
c) Učí ich novým mäsiarskym technikám a pomáha im prosperovať bez negatívnych následkov.
4. V poviedke Dušana Mitanu "Nočné správy", aký pocit dominuje u hlavného hrdinu?
a) Radosť a spokojnosť so životom
b) Istota a dôvera v spoločenský systém
c) Strach, paranoja a pocit ohrozenia vonkajšou mocou
Správne odpovede:
1. b)
2. c)
3. b)
4. c)
        `;
        const testInformacnySlohDramaPo1945 = `
Test: Informačný slohový postup a Slovenská dráma po 1945
1. Ktorý z uvedených útvarov je typickým príkladom informačného slohového postupu?
a) Úvaha
b) Správa
c) Rozprávka
2. Ktorí dvaja dramatici sú známi svojím intelektuálnym kabaretným divadlom, ktoré využívalo humor, satiru a prvky absurdity?
a) Ján Solovič a Osvald Záhradník
b) Ivan Stodola a Július Barč-Ivan
c) Milan Lasica a Július Satinský
3. V hre Ivana Bukovčana "Kým kohút nezaspieva", prečo sú rukojemníci zadržaní?
a) Za krádež v miestnom obchode
b) Za údajnú vraždu nemeckého vojaka
c) Za organizovanie protifašistického odboja
4. Akú funkciu plní titulok a nadtitulok v správe (informačný slohový postup)?
a) Len estetickú, aby text lepšie vyzeral
b) Upútať pozornosť a stručne informovať o obsahu správy
c) Skryť hlavnú myšlienku správy
Správne odpovede:
1. b)
2. c)
3. b)
4. b)
        `;
        const testJazykRecProzaPo1945 = `
Test: Jazyk, Reč a Slovenská próza po 1945
1. Čo je hlavným rozdielom medzi jazykom a rečou?
a) Jazyk je konkrétna realizácia reči.
b) Jazyk je systém znakov a pravidiel, reč je jeho konkrétne použitie.
c) Reč je vždy písomná, jazyk je vždy ústny.
2. Ktorý slovenský autor napísal román-rieku "Červené víno", zobrazujúci osudy troch generácií vinohradníckej rodiny Habdžovcov?
a) Rudolf Jašík
b) František Hečko
c) Dušan Dušek
3. Aký typ románu je dielo, v ktorom autor zobrazuje svoj vlastný životopis?
a) Biografický román
b) Historický román
c) Autobiografický román
4. V poviedke Dušana Dušeka "Pes" z knihy "Kufor na sny", aký je hlavný motív úvah autora?
a) Kritika zaobchádzania so zvieratami
b) Ponímanie slova "blázon" a vzťah človeka so psom
c) Opis krás slovenskej prírody
Správne odpovede:
1. b)
2. b)
3. c)
4. b)
        `;

        const slovencinaTestContents = [
            testSlovnaZasobaLiteratura, testFrazeologizmusStredovek, testSyntaxHumanizmus,
            testSuvetiaBarok, testProzodiaKlasicizmus, testPodstatneMenaDrama,
            testVyvinJazykaRomantizmusSvetovy, testKomunikaciaRomantizmusSk,
            testPublicistickyStylUmenie, testSlohovePostupyStur,
            testAdministrativnyStylBottoChalupka, testOpisSladkovic, testCharakteristikaRealizmusSvetovy,
            testSlovZasobaHviezdoslavSladkovic, testJazykoveStylyRealizmusSk,
            testUvahaHronsky, testVetneClenyPrvaSvetova,
            testSlovesaLyrizovanaProza, testDiakritikaInterpunkciaDramaMedzivojnova,
            testZvukovaStrankaSvetovaPo1945, testRecnickyStylVojnaNeorealizmusSocialReal,
            testDiskusnyPrispevokSlovPoeziaPo1945, testRecnickePrejavyJasikBednar,
            testRozpravaciSlohTotalita, testSlovLitPo1945BallekMitana,
            testInformacnySlohDramaPo1945, testJazykRecProzaPo1945
        ];

        // Firebase instance variables
        let db, auth, currentUserId = null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';


        let structuredQuizData = [];
        let currentTestObject = null; 
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswer = null; 
        let quizStartTime = 0; 
        let quizDurationSeconds = 0; 
        // currentDifficulty variable removed as difficulty selection is removed

        let timerInterval = null;
        let timeLeftInSeconds = 0;
        let timerMinutesSetting = 10;
        let noTimerMode = false;
        
        const topicSelectionScreen = document.getElementById('topic-selection-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultsScreen = document.getElementById('results-screen');
        const statisticsScreen = document.getElementById('statistics-screen'); 
        const sectionsContainer = document.getElementById('sections-container');
        const quizTopicTitle = document.getElementById('quiz-topic-title');
        const questionTextEl = document.getElementById('question-text');
        const optionsContainer = document.getElementById('options-container');
        const hardModeAnswerInput = document.getElementById('hard-mode-answer-input'); // Kept for potential future use, but not actively used
        const feedbackTextEl = document.getElementById('feedback-text');
        const scoreTextEl = document.getElementById('score-text');
        const questionCounterTextEl = document.getElementById('question-counter-text');
        const submitAnswerButton = document.getElementById('submit-answer-button');
        const finalScoreTextEl = document.getElementById('final-score-text');
        const probableGradeTimeValueEl = document.getElementById('probable-grade-time-value'); 
        const resultMessageTextEl = document.getElementById('result-message-text');
        const quizDurationTextEl = document.getElementById('quiz-duration-text');
        const quizDurationValueEl = document.getElementById('quiz-duration-value');
        const restartQuizButton = document.getElementById('restart-quiz-button');
        const changeTopicButton = document.getElementById('change-topic-button');
        const backToTopicsButton = document.getElementById('back-to-topics');
        const timerMinutesInput = document.getElementById('timer-minutes');
        const noTimerButton = document.getElementById('no-timer-button');
        const timerDisplayEl = document.getElementById('timer-display');
        const timeLeftEl = document.getElementById('time-left');
        const timerInfoEl = document.getElementById('timer-info');
        // Difficulty buttons (difficultyEasyButton, difficultyHardButton) are no longer needed
        const themeToggleButton = document.getElementById('theme-toggle-button');
        const themeIconSun = document.getElementById('theme-icon-sun');
        const themeIconMoon = document.getElementById('theme-icon-moon');
        
        const explanationControlsEl = document.getElementById('explanation-controls');
        const explainAnswerButtonEl = document.getElementById('explain-answer-button');
        const explanationLoadingEl = document.getElementById('explanation-loading');
        const explanationContentEl = document.getElementById('explanation-content');

        const getQuizAnalysisButtonEl = document.getElementById('get-quiz-analysis-button');
        const quizAnalysisLoadingEl = document.getElementById('quiz-analysis-loading');
        const quizAnalysisContentEl = document.getElementById('quiz-analysis-content');

        const questionContainer = document.getElementById('question-container');

        // Statistics Screen Elements
        const showStatsButton = document.getElementById('show-stats-button');
        const backToTopicsFromStatsButton = document.getElementById('back-to-topics-from-stats');
        const statsLoadingEl = document.getElementById('stats-loading');
        const statsContentEl = document.getElementById('stats-content');
        const statsTotalTestsEl = document.getElementById('stats-total-tests');
        const statsTotalTimeEl = document.getElementById('stats-total-time');
        const statsHistoryTableBodyEl = document.getElementById('stats-history-table-body');
        const statsNoHistoryEl = document.getElementById('stats-no-history');
        const statsUserIdEl = document.getElementById('stats-user-id').querySelector('span');
        const statsAverageScoreEl = document.getElementById('stats-average-score');
        const statsCommonestGradeEl = document.getElementById('stats-commonest-grade');


        // --- Firebase Initialization and Auth ---
        async function initFirebase() {
            try {
                // @ts-ignore
                const firebaseConfig = {
  apiKey: "AIzaSyCmApNSHVbLk8yVijA4BWER4S6u2q42qdI",
  authDomain: "dsa-quiz-b3212.firebaseapp.com",
  projectId: "dsa-quiz-b3212",
  storageBucket: "dsa-quiz-b3212.firebasestorage.app",
  messagingSenderId: "90124709586",
  appId: "1:90124709586:web:b732304990c12ebd62870b",
  measurementId: "G-MF71K72X9T"
};
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                setLogLevel('debug'); // Enable Firestore logging for development
                console.log("Firebase initialized. App ID:", appId);
                await listenForAuthStateChanges();
            } catch (error) {
                console.error("Error initializing Firebase:", error);
                displayGlobalError("Chyba pri inicializácii Firebase. Štatistiky nebudú dostupné.");
            }
        }

        async function listenForAuthStateChanges() {
            return new Promise((resolve, reject) => {
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        console.log("User is signed in. UID:", currentUserId);
                        if(statsUserIdEl) statsUserIdEl.textContent = currentUserId;
                        resolve(user);
                    } else {
                        console.log("User is signed out. Attempting to sign in...");
                        try {
                            // @ts-ignore
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                                console.log("Attempting sign in with custom token.");
                                const userCredential = await signInWithCustomToken(auth, __initial_auth_token);
                                currentUserId = userCredential.user.uid;
                                console.log("Signed in with custom token. UID:", currentUserId);
                                if(statsUserIdEl) statsUserIdEl.textContent = currentUserId;
                            // @ts-ignore
                            } else if (typeof signInAnonymously !== 'undefined') { 
                                console.log("Attempting anonymous sign in.");
                                const userCredential = await signInAnonymously(auth);
                                currentUserId = userCredential.user.uid;
                                console.log("Signed in anonymously. UID:", currentUserId);
                                if(statsUserIdEl) statsUserIdEl.textContent = currentUserId;
                            } else {
                                console.warn("No auth token and signInAnonymously is not available. User remains unauthenticated.");
                                currentUserId = 'anonymous_' + crypto.randomUUID(); 
                                if(statsUserIdEl) statsUserIdEl.textContent = currentUserId + " (lokálne)";
                            }
                            resolve(auth.currentUser);
                        } catch (error) {
                            console.error("Error during sign-in:", error);
                            currentUserId = 'error_' + crypto.randomUUID(); 
                             if(statsUserIdEl) statsUserIdEl.textContent = "Chyba prihlásenia";
                            displayGlobalError("Chyba pri prihlasovaní užívateľa. Štatistiky nemusia fungovať správne.");
                            reject(error);
                        }
                    }
                }, (error) => { 
                    console.error("Auth state listener error:", error);
                    currentUserId = 'error_listener_' + crypto.randomUUID();
                    if(statsUserIdEl) statsUserIdEl.textContent = "Chyba prihlásenia";
                    displayGlobalError("Chyba pri sledovaní stavu autentifikácie.");
                    reject(error);
                });
            });
        }

        function displayGlobalError(message) {
            console.error("GLOBAL ERROR:", message);
        }


        // --- Cookie Functions ---
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (encodeURIComponent(value) || "")  + expires + "; path=/; SameSite=Lax";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for(let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
            }
            return null;
        }

        // --- Theme Toggle ---
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.remove('light-mode');
                document.body.classList.add('dark-mode');
                if(themeIconSun) themeIconSun.classList.add('hidden');
                if(themeIconMoon) themeIconMoon.classList.remove('hidden');
            } else {
                document.body.classList.remove('dark-mode');
                document.body.classList.add('light-mode');
                if(themeIconMoon) themeIconMoon.classList.add('hidden');
                if(themeIconSun) themeIconSun.classList.remove('hidden');
            }
        }

        themeToggleButton.addEventListener('click', () => {
            const isDarkMode = document.body.classList.contains('dark-mode');
            const newTheme = isDarkMode ? 'light' : 'dark';
            setCookie('theme', newTheme, 365); 
            applyTheme(newTheme);
        });


        // --- Helper Functions ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function parseSingleTest(docContent) {
            const lines = docContent.split('\n').map(line => line.trim()).filter(line => line);
            let topic = "";
            const questions = [];
            let currentQ = null;
            let questionNum = 0;
            const topicLine = lines.find(line => line.startsWith("Test:"));
            if (topicLine) topic = topicLine.replace("Test:", "").trim();
            
            let correctAnswersSectionStartIndex = -1;
            for (let i = lines.length - 1; i >= 0; i--) {
                 if (lines[i].toLowerCase().startsWith("správne odpovede")) { 
                    correctAnswersSectionStartIndex = i; 
                    break; 
                }
            }

            const correctAnswersMap = {};
            if (correctAnswersSectionStartIndex !== -1) {
                for (let i = correctAnswersSectionStartIndex + 1; i < lines.length; i++) {
                    const match = lines[i].match(/^(\d+)\s*\.\s*([a-z])\)?/i);
                    if (match) correctAnswersMap[parseInt(match[1])] = match[2].toLowerCase();
                }
            }
            
            const endParseLimit = correctAnswersSectionStartIndex !== -1 ? correctAnswersSectionStartIndex : lines.length;
            for (let i = 0; i < endParseLimit; i++) {
                const line = lines[i];
                if (line.startsWith("Test:")) continue;
                const qMatch = line.match(/^(\d+)\.\s+(.*)/);
                if (qMatch) {
                    if (currentQ && Object.keys(currentQ.options).length > 0) questions.push(currentQ);
                    questionNum = parseInt(qMatch[1]);
                    currentQ = { 
                        id: questionNum, 
                        question: qMatch[2].trim(), 
                        options: {}, 
                        correctLetter: correctAnswersMap[questionNum] || null, 
                        correctText: '' 
                    };
                } else if (currentQ) {
                    const optMatch = line.match(/^([a-zA-Z])\)\s+(.*)/i);
                    if (optMatch) {
                        const letter = optMatch[1].toLowerCase();
                        const text = optMatch[2].trim();
                        currentQ.options[letter] = text;
                        if (currentQ.correctLetter === letter) {
                            currentQ.correctText = text;
                        }
                    }
                }
            }
            if (currentQ && Object.keys(currentQ.options).length > 0) questions.push(currentQ);
            
            questions.forEach(q => { 
                if (q.correctLetter && !q.correctText && q.options[q.correctLetter]) {
                    q.correctText = q.options[q.correctLetter];
                }
            });

            const validQuestions = questions.filter(q => q.question && q.correctLetter && q.correctText && Object.keys(q.options).length >= 2);
            if (topic && validQuestions.length > 0) return { topic, questions: validQuestions };
            return null;
        }


        function structureAllTests() {
            const parsedElektrotechnikaTestsHudecova = elektrotechnikaTestContentsHudecova.map((docString, index) => { 
                const parsedTest = parseSingleTest(docString);
                if (parsedTest) parsedTest.sectionName = "Mechanika Elektrotechnika (testy od Hudecovej)";
                return parsedTest;
            }).filter(Boolean); 

            const parsedNovaMechanikaElektrotechnikaTests = novaMechanikaElektrotechnikaTestContents.map((docString, index) => {
                const parsedTest = parseSingleTest(docString);
                if (parsedTest) parsedTest.sectionName = "Mechanika Elektrotechnika"; 
                return parsedTest;
            }).filter(Boolean);

            const parsedEkonomikaTests = ekonomikaTestContents.map((docString, index) => { 
                const parsedTest = parseSingleTest(docString);
                if (parsedTest) parsedTest.sectionName = "Ekonomika";
                return parsedTest;
            }).filter(Boolean);

            const parsedSlovencinaTests = slovencinaTestContents.map((docString, index) => {
                const parsedTest = parseSingleTest(docString);
                if (parsedTest) parsedTest.sectionName = "Slovenčina";
                return parsedTest;
            }).filter(Boolean);

            structuredQuizData = [
                { sectionName: "Mechanika Elektrotechnika (testy od Hudecovej)", tests: parsedElektrotechnikaTestsHudecova },
                { sectionName: "Mechanika Elektrotechnika", tests: parsedNovaMechanikaElektrotechnikaTests }, 
                { sectionName: "Ekonomika", tests: parsedEkonomikaTests }, 
                { sectionName: "Slovenčina", tests: parsedSlovencinaTests }
            ];
        }
        
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function formatDuration(totalSeconds) {
            if (isNaN(totalSeconds) || totalSeconds === null || totalSeconds === undefined) return 'N/A';
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${minutes}m ${seconds.toString().padStart(2, '0')}s`;
        }
         function formatTotalDuration(totalSeconds) {
            if (isNaN(totalSeconds) || totalSeconds === null || totalSeconds === undefined) return 'N/A';
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            return `${hours}h ${minutes}m ${seconds.toString().padStart(2, '0')}s`;
        }


        function startTimer() {
            quizStartTime = Date.now(); 
            if (noTimerMode) {
                timerDisplayEl.classList.add('hidden');
                return;
            }
            timerDisplayEl.classList.remove('hidden');
            timeLeftInSeconds = timerMinutesSetting * 60;
            timeLeftEl.textContent = formatTime(timeLeftInSeconds);
            clearInterval(timerInterval); 
            timerInterval = setInterval(() => {
                timeLeftInSeconds--;
                timeLeftEl.textContent = formatTime(timeLeftInSeconds);
                if (timeLeftInSeconds <= 0) {
                    clearInterval(timerInterval);
                    feedbackTextEl.textContent = 'Čas vypršal! Test bol automaticky ukončený.'; 
                    feedbackTextEl.className = 'mb-4 min-h-[30px] text-center text-lg font-semibold text-red-feedback'; 
                    explanationControlsEl.classList.add('hidden'); 

                    if (optionsContainer) optionsContainer.classList.add('disabled-options');
                    Array.from(optionsContainer.children).forEach(btn => { 
                        if(btn.tagName === 'BUTTON') btn.disabled = true; 
                    });
                    if (hardModeAnswerInput) hardModeAnswerInput.disabled = true;
                    if (submitAnswerButton) submitAnswerButton.disabled = true;
                    
                    showResults(); 
                }
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
            quizDurationSeconds = Math.floor((Date.now() - quizStartTime) / 1000);
        }

        function showScreen(screenToShow) {
            [topicSelectionScreen, quizScreen, resultsScreen, statisticsScreen].forEach(s => {
                if (s) s.classList.add('hidden'); 
            }); 
            if (screenToShow) screenToShow.classList.remove('hidden');
        }

        function loadSectionsAndTopics() {
            sectionsContainer.innerHTML = ''; 
            structuredQuizData.forEach((section) => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = 'section-block mb-6';
                
                const titleContainer = document.createElement('div');
                titleContainer.className = 'flex justify-between items-center mb-3'; 

                const sectionTitleEl = document.createElement('h2');
                sectionTitleEl.className = 'text-2xl font-semibold text-sky-title section-title flex-grow'; 
                sectionTitleEl.textContent = section.sectionName;
                titleContainer.appendChild(sectionTitleEl);

                if (section.tests && section.tests.length > 0) {
                    const randomTestButton = document.createElement('button');
                    randomTestButton.className = 'random-test-button py-1 px-3 text-sm rounded-md ml-4'; 
                    randomTestButton.textContent = 'Náhodný Test';
                    randomTestButton.onclick = () => {
                        const randomIndex = Math.floor(Math.random() * section.tests.length);
                        startQuiz(section.tests[randomIndex]);
                    };
                    titleContainer.appendChild(randomTestButton);
                }
                sectionDiv.appendChild(titleContainer);


                const testsGridDiv = document.createElement('div');
                testsGridDiv.className = 'grid grid-cols-1 sm:grid-cols-2 gap-4';

                if (section.tests.length > 0) {
                    section.tests.forEach((test) => {
                        const button = document.createElement('button');
                        button.className = 'action-button py-4 px-6 text-left w-full text-base sm:text-lg'; 
                        button.textContent = test.topic;
                        button.onclick = () => startQuiz(test); 
                        testsGridDiv.appendChild(button);
                    });
                } else {
                    const noTestsText = document.createElement('p');
                    noTestsText.className = 'text-muted-color italic col-span-full';
                    noTestsText.textContent = 'V tejto sekcii zatiaľ nie sú žiadne testy.';
                    testsGridDiv.appendChild(noTestsText);
                }
                sectionDiv.appendChild(testsGridDiv);
                sectionsContainer.appendChild(sectionDiv);
            });
            showScreen(topicSelectionScreen);
        }

        function startQuiz(testObject) { 
            currentTestObject = JSON.parse(JSON.stringify(testObject)); 
            
            // Always shuffle questions as difficulty selection is removed
            shuffleArray(currentTestObject.questions); 
            
            currentQuestionIndex = 0;
            score = 0;
            selectedAnswer = null;
            quizTopicTitle.textContent = currentTestObject.topic;

            if (!noTimerMode) {
                const minutes = parseInt(timerMinutesInput.value);
                timerMinutesSetting = (!isNaN(minutes) && minutes > 0) ? minutes : 10; 
                timerMinutesInput.value = timerMinutesSetting.toString(); 
            }
            
            showScreen(quizScreen);
            startTimer(); 

            questionContainer.classList.remove('hidden');
            submitAnswerButton.classList.remove('hidden');
            displayQuestion();
        }
        
        function displayQuestion() {
            if (!currentTestObject || !currentTestObject.questions || currentQuestionIndex >= currentTestObject.questions.length) {
                showResults();
                return;
            }
            const q = currentTestObject.questions[currentQuestionIndex];
            if (!q || !q.options) { 
                console.error("Chybná otázka alebo chýbajúce možnosti:", q);
                feedbackTextEl.textContent = "Chyba: Nepodarilo sa načítať otázku.";
                currentQuestionIndex++;
                if (currentQuestionIndex >= currentTestObject.questions.length) showResults(); else displayQuestion();
                return;
            }

            questionTextEl.textContent = q.question;
            optionsContainer.innerHTML = '';
            optionsContainer.classList.remove('disabled-options'); 
            hardModeAnswerInput.classList.add('hidden'); 
            hardModeAnswerInput.value = '';
            hardModeAnswerInput.classList.remove('border-green-500', 'border-red-500', 'border-2'); 
            
            explanationControlsEl.classList.add('hidden');
            explanationContentEl.classList.add('hidden');
            explanationContentEl.textContent = '';
            explanationLoadingEl.classList.add('hidden');
            explainAnswerButtonEl.disabled = true; 

            let optionLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H']; 
            const optionsArray = [];
            for (const key in q.options) {
                optionsArray.push({ originalKey: key, text: q.options[key] });
            }

            // Always shuffle and display all options as difficulty is removed
            shuffleArray(optionsArray);
            const optionsToDisplay = optionsArray; 
            
            optionsToDisplay.forEach((opt, index) => {
                const button = document.createElement('button');
                button.className = 'option-button block w-full text-left py-3 px-5 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500';
                button.textContent = `${optionLetters[index % optionLetters.length]}) ${opt.text}`; 
                button.dataset.answer = opt.originalKey; 
                button.onclick = () => selectAnswer(opt.originalKey, button);
                optionsContainer.appendChild(button);
            });
            submitAnswerButton.disabled = true; 


            feedbackTextEl.textContent = '';
            feedbackTextEl.className = 'mb-4 min-h-[30px] text-center text-lg'; 
            scoreTextEl.textContent = `Skóre: ${score}/${currentTestObject.questions.length}`;
            questionCounterTextEl.textContent = `Otázka: ${currentQuestionIndex + 1}/${currentTestObject.questions.length}`;
            submitAnswerButton.textContent = 'Potvrdiť Odpoveď';
            submitAnswerButton.classList.remove('next-question-style'); 
            selectedAnswer = null; 
        }

        function selectAnswer(answerKey, buttonEl) { 
            if (optionsContainer.classList.contains('disabled-options')) return; 
            selectedAnswer = answerKey;
            Array.from(optionsContainer.children).forEach(btn => btn.classList.remove('selected'));
            buttonEl.classList.add('selected');
            submitAnswerButton.disabled = false;
        }

        function handleSubmitAnswer(timeExpiredAfterSelection = false) {
            if (!currentTestObject) return;
            const q = currentTestObject.questions[currentQuestionIndex];
            if (!q) {
                console.error("Current question is undefined in handleSubmitAnswer");
                currentQuestionIndex++;
                if (currentQuestionIndex >= currentTestObject.questions.length) showResults(); else displayQuestion();
                return;
            }
            let isCorrect = false;

            explanationControlsEl.classList.add('hidden');
            explanationContentEl.classList.add('hidden');
            explanationContentEl.textContent = '';
            explainAnswerButtonEl.disabled = true; 

            if (selectedAnswer !== null) { 
                isCorrect = selectedAnswer === q.correctLetter;
            } else {
                isCorrect = false; 
            }
            
            Array.from(optionsContainer.children).forEach(button => {
                if (button.tagName === 'BUTTON') {
                    button.disabled = true; 
                    if (button.dataset.answer === q.correctLetter) button.classList.add('correct');
                    if (button.dataset.answer === selectedAnswer && !isCorrect) button.classList.add('incorrect');
                }
            });
            optionsContainer.classList.add('disabled-options');
            
            let timeOutPrefix = timeExpiredAfterSelection ? "Čas vypršal! " : "";

            if (isCorrect) {
                score++;
                feedbackTextEl.textContent = timeOutPrefix + 'Správna odpoveď!';
                feedbackTextEl.className = 'mb-4 min-h-[30px] text-center text-lg font-semibold text-green-feedback';
            } else {
                let incorrectMsgDetail;
                if (timeExpiredAfterSelection && selectedAnswer === null) { 
                    incorrectMsgDetail = 'Nestihli ste odpovedať.';
                } else { 
                    incorrectMsgDetail = `Nesprávne. Správna odpoveď: <span class="font-bold">${q.options[q.correctLetter] ? q.correctLetter.toUpperCase() + ') ' : ''}${q.correctText}</span>`;
                }
                feedbackTextEl.innerHTML = timeOutPrefix + incorrectMsgDetail;
                feedbackTextEl.className = 'mb-4 min-h-[30px] text-center text-lg font-semibold text-red-feedback';
                explanationControlsEl.classList.remove('hidden');
                explainAnswerButtonEl.disabled = false;
            }
            
            scoreTextEl.textContent = `Skóre: ${score}/${currentTestObject.questions.length}`;
            
            currentQuestionIndex++;
            if (currentQuestionIndex >= currentTestObject.questions.length) {
                submitAnswerButton.textContent = 'Zobraziť Výsledky';
                submitAnswerButton.classList.remove('next-question-style');
                if (timeExpiredAfterSelection) stopTimer(); 
            } else {
                submitAnswerButton.textContent = 'Ďalšia Otázka';
                submitAnswerButton.classList.add('next-question-style');
            }
            submitAnswerButton.disabled = false; 
        }
        
        submitAnswerButton.onclick = () => {
            if (timeLeftInSeconds <= 0 && !noTimerMode && submitAnswerButton.textContent === 'Potvrdiť Odpoveď' && !submitAnswerButton.classList.contains('next-question-style')) {
                return;
            }
            
            if (submitAnswerButton.textContent === 'Potvrdiť Odpoveď') {
                 handleSubmitAnswer(false); 
            } else if (submitAnswerButton.textContent === 'Zobraziť Výsledky' || currentQuestionIndex >= currentTestObject.questions.length) {
                showResults();
            } else { 
                // hardModeAnswerInput is not actively used if difficulty is removed
                // if(currentDifficulty === 'hard') hardModeAnswerInput.disabled = false; 
                displayQuestion();
            }
        };

        function calculateGrade(percentage) { 
            if (percentage >= 90) return "1 (Výborný)";
            if (percentage >= 75) return "2 (Chválitebný)";
            if (percentage >= 50) return "3 (Dobrý)";
            if (percentage >= 30) return "4 (Dostatočný)";
            return "5 (Nedostatočný)";
        }

        function calculateProbableGradeWithTime(currentScore, totalQuestions, durationSeconds) {
            if (totalQuestions === 0) return calculateGrade(0); 
            const basePercentage = (currentScore / totalQuestions) * 100;
            let adjustedPercentage = basePercentage;
            const timePerQuestion = durationSeconds / totalQuestions;

            if (timePerQuestion < 45 && basePercentage >= 50) { 
                adjustedPercentage = Math.min(100, basePercentage + 5); 
            } 
            else if (timePerQuestion > 90 && basePercentage < 90 && basePercentage >= 30) { 
                adjustedPercentage = Math.max(0, basePercentage - 5); 
            }
            return calculateGrade(adjustedPercentage);
        }

        async function saveQuizAttemptToFirestore(quizData) {
            if (!currentUserId) {
                console.error("Cannot save quiz attempt: User not authenticated.");
                return;
            }
            if (!db) {
                console.error("Cannot save quiz attempt: Firestore not initialized.");
                return;
            }

            try {
                const quizHistoryCollectionPath = `/artifacts/${appId}/users/${currentUserId}/quizHistory`;
                const quizHistoryRef = collection(db, quizHistoryCollectionPath);
                await addDoc(quizHistoryRef, {
                    ...quizData,
                    completedAt: serverTimestamp() 
                });
                console.log("Quiz attempt saved to Firestore for user:", currentUserId);
            } catch (error) {
                console.error("Error saving quiz attempt to Firestore:", error);
            }
        }


        async function showResults() { 
            stopTimer(); 
            if (!currentTestObject) return; 
            finalScoreTextEl.textContent = `Tvoje skóre: ${score} z ${currentTestObject.questions.length}`;
            
            const probableGradeWithTime = calculateProbableGradeWithTime(score, currentTestObject.questions.length, quizDurationSeconds);
            probableGradeTimeValueEl.textContent = probableGradeWithTime;

            const percentage = currentTestObject.questions.length > 0 ? (score / currentTestObject.questions.length) * 100 : 0;
            let message = "";
            if (percentage === 100) message = "Perfektné! Všetko správne!";
            else if (percentage >= 75) message = "Výborne! Skvelý výsledok!";
            else if (percentage >= 50) message = "Dobre, ale je tu priestor na zlepšenie.";
            else message = "Nevadí, skús to znova a určite to bude lepšie!";
            
            resultMessageTextEl.textContent = message; 
            quizDurationValueEl.textContent = formatDuration(quizDurationSeconds);

            quizAnalysisLoadingEl.classList.add('hidden');
            quizAnalysisContentEl.classList.add('hidden');
            quizAnalysisContentEl.textContent = '';
            getQuizAnalysisButtonEl.disabled = false;

            const quizDataToSave = {
                quizName: currentTestObject.topic,
                score: score,
                totalQuestions: currentTestObject.questions.length,
                durationSeconds: quizDurationSeconds,
                grade: probableGradeWithTime
                // difficulty field removed
            };
            await saveQuizAttemptToFirestore(quizDataToSave); 

            showScreen(resultsScreen);
        }
        
        // --- Gemini API Call Function ---
        async function callGeminiAPI(prompt) {
            const apiKey = "AIzaSyBewKupprhzIsQl3Oys2eE9z9NNMm36ipI"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
            
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    console.error("Gemini API error:", errorData);
                    return `Chyba pri komunikácii s AI: ${errorData.error?.message || response.statusText}`;
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text;
                } else {
                    console.error("Unexpected Gemini API response structure:", result);
                    return "Nepodarilo sa získať odpoveď od AI. Skúste to neskôr.";
                }
            } catch (error) {
                console.error("Error calling Gemini API:", error);
                return "Nastala chyba pri kontaktovaní AI. Skontrolujte pripojenie alebo skúste neskôr.";
            }
        }

        // --- AI Explanation for Answer ---
        explainAnswerButtonEl.addEventListener('click', async () => {
            if (!currentTestObject || currentQuestionIndex === 0) return; 
            
            const questionJustAnsweredIndex = currentQuestionIndex -1; 
            const q = currentTestObject.questions[questionJustAnsweredIndex];
            if (!q) return;

            explanationLoadingEl.classList.remove('hidden');
            explanationContentEl.classList.add('hidden');
            explanationContentEl.textContent = '';
            explainAnswerButtonEl.disabled = true;

            const optionsText = Object.entries(q.options).map(([key, value]) => `${key}) ${value}`).join('\n');
            // Prompt updated to remove difficulty context
            const prompt = `Vysvetli stručne a jasne, prečo je odpoveď "${q.correctText}" správna na otázku: "${q.question}". Možnosti boli:\n${optionsText}\nZameraj sa len na vysvetlenie správnej odpovede. Odpovedaj po slovensky.`;
            
            const explanation = await callGeminiAPI(prompt);
            
            explanationLoadingEl.classList.add('hidden');
            explanationContentEl.textContent = explanation;
            explanationContentEl.classList.remove('hidden');
        });

        // --- AI Quiz Analysis ---
        getQuizAnalysisButtonEl.addEventListener('click', async () => {
            if (!currentTestObject) return;

            quizAnalysisLoadingEl.classList.remove('hidden');
            quizAnalysisContentEl.classList.add('hidden');
            quizAnalysisContentEl.textContent = '';
            getQuizAnalysisButtonEl.disabled = true;

            // Prompt updated to remove difficulty context
            const prompt = `Analyzuj stručne výkon v teste s názvom "${currentTestObject.topic}". Hráč dosiahol skóre ${score} z ${currentTestObject.questions.length} otázok. Test trval ${formatDuration(quizDurationSeconds)}. Poskytni celkové zhodnotenie a prípadne jednu alebo dve rady na zlepšenie alebo povzbudenie. Odpovedaj po slovensky.`;

            const analysis = await callGeminiAPI(prompt);

            quizAnalysisLoadingEl.classList.add('hidden');
            quizAnalysisContentEl.innerHTML = analysis.replace(/\n/g, '<br>'); 
            quizAnalysisContentEl.classList.remove('hidden');
        });

        // Difficulty button event listeners removed
        
        restartQuizButton.onclick = () => { if (currentTestObject) startQuiz(currentTestObject); };
        changeTopicButton.onclick = () => showScreen(topicSelectionScreen);
        backToTopicsButton.onclick = () => { stopTimer(); showScreen(topicSelectionScreen); };
        noTimerButton.onclick = () => {
            noTimerMode = !noTimerMode;
            timerMinutesInput.disabled = noTimerMode;
            timerMinutesInput.classList.toggle('opacity-50', noTimerMode);
            noTimerButton.textContent = noTimerMode ? 'S časovačom' : 'Bez limitu';
            
            if(noTimerMode){
                noTimerButton.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--sky-text'); 
                noTimerButton.style.color = 'white';
            } else {
                noTimerButton.style.backgroundColor = ''; 
                noTimerButton.style.color = '';
            }

            timerInfoEl.textContent = noTimerMode ? "Časový limit je vypnutý." : "Zadajte počet minút alebo vyberte \"Bez limitu\".";
        };
        timerMinutesInput.addEventListener('input', () => {
            if (noTimerMode) { noTimerMode = false; 
                timerMinutesInput.disabled = false; timerMinutesInput.classList.remove('opacity-50');
                noTimerButton.textContent = 'Bez limitu'; 
                noTimerButton.style.backgroundColor = ''; 
                noTimerButton.style.color = '';
                timerInfoEl.textContent = "Zadajte počet minút alebo vyberte \"Bez limitu\".";
            }
        });

        // --- Statistics Screen Logic ---
        async function displayStatistics() {
            showScreen(statisticsScreen);
            statsLoadingEl.classList.remove('hidden');
            statsContentEl.classList.add('hidden');
            statsNoHistoryEl.classList.add('hidden');
            statsHistoryTableBodyEl.innerHTML = ''; 

            if (!currentUserId) {
                console.warn("User not authenticated, cannot fetch stats.");
                statsLoadingEl.textContent = "Pre zobrazenie štatistík je potrebné prihlásenie. Skúste obnoviť stránku.";
                statsNoHistoryEl.classList.remove('hidden');
                statsNoHistoryEl.textContent = "Prihlásenie zlyhalo alebo nie je dostupné.";
                return;
            }
             if (!db) {
                console.error("Firestore not initialized, cannot fetch stats.");
                statsLoadingEl.textContent = "Chyba: Databáza nie je dostupná.";
                statsNoHistoryEl.classList.remove('hidden');
                statsNoHistoryEl.textContent = "Nepodarilo sa pripojiť k databáze štatistík.";
                return;
            }


            try {
                const quizHistoryCollectionPath = `/artifacts/${appId}/users/${currentUserId}/quizHistory`;
                const q = query(collection(db, quizHistoryCollectionPath), orderBy("completedAt", "desc"));
                const querySnapshot = await getDocs(q);

                let totalTests = 0;
                let totalTimeSpentSeconds = 0;
                let totalScoreSum = 0;
                let totalPossibleScoreSum = 0;
                const gradeCounts = {};


                if (querySnapshot.empty) {
                    statsNoHistoryEl.classList.remove('hidden');
                } else {
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        totalTests++;
                        totalTimeSpentSeconds += data.durationSeconds || 0;
                        totalScoreSum += data.score || 0;
                        totalPossibleScoreSum += data.totalQuestions || 0;

                        if (data.grade) {
                            gradeCounts[data.grade] = (gradeCounts[data.grade] || 0) + 1;
                        }


                        const row = statsHistoryTableBodyEl.insertRow();
                        row.insertCell().textContent = data.quizName || 'Neznámy test';
                        
                        let dateText = 'Neznámy dátum';
                        if (data.completedAt && data.completedAt.toDate) {
                            try {
                                dateText = data.completedAt.toDate().toLocaleString('sk-SK', {dateStyle: 'medium', timeStyle: 'short'});
                            } catch (e) { console.warn("Error formatting date:", e, data.completedAt)}
                        } else if (data.completedAt) { 
                             try {
                                dateText = new Date(data.completedAt).toLocaleString('sk-SK', {dateStyle: 'medium', timeStyle: 'short'});
                             } catch (e) { console.warn("Error formatting date from string/number:", e, data.completedAt)}
                        }
                        row.insertCell().textContent = dateText;

                        row.insertCell().textContent = `${data.score}/${data.totalQuestions}`;
                        row.insertCell().textContent = data.grade || '--';
                        row.insertCell().textContent = formatDuration(data.durationSeconds);
                        // Difficulty data removed from table row
                    });
                }

                statsTotalTestsEl.textContent = totalTests;
                statsTotalTimeEl.textContent = formatTotalDuration(totalTimeSpentSeconds);
                
                if (totalPossibleScoreSum > 0) {
                    const avgScorePercentage = (totalScoreSum / totalPossibleScoreSum) * 100;
                    statsAverageScoreEl.textContent = `${avgScorePercentage.toFixed(1)}% (${totalScoreSum}/${totalPossibleScoreSum})`;
                } else {
                    statsAverageScoreEl.textContent = 'N/A';
                }

                if (Object.keys(gradeCounts).length > 0) {
                    const commonestGrade = Object.entries(gradeCounts).sort(([,a],[,b]) => b-a)[0][0];
                    statsCommonestGradeEl.textContent = commonestGrade;
                } else {
                    statsCommonestGradeEl.textContent = 'N/A';
                }


            } catch (error) {
                console.error("Error fetching statistics:", error);
                statsLoadingEl.textContent = "Chyba pri načítaní štatistík.";
                statsNoHistoryEl.classList.remove('hidden');
                statsNoHistoryEl.textContent = "Nepodarilo sa načítať históriu testov.";
            } finally {
                statsLoadingEl.classList.add('hidden');
                statsContentEl.classList.remove('hidden');
            }
        }

        showStatsButton.addEventListener('click', displayStatistics);
        backToTopicsFromStatsButton.addEventListener('click', () => showScreen(topicSelectionScreen));


        async function initializeAppSequence() {
            const savedTheme = getCookie('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            applyTheme(savedTheme);
            
            console.log("Initializing Quiz App with AI Features & Statistics...");
            
            try {
                await initFirebase(); 
                 if(statsUserIdEl && currentUserId) statsUserIdEl.textContent = currentUserId;
                 else if (statsUserIdEl) statsUserIdEl.textContent = "Neprihlásený";
            } catch (error) {
                console.error("Firebase initialization failed in sequence:", error);
            }

            structureAllTests(); 
            if (structuredQuizData.length > 0 && 
                (structuredQuizData.some(sec => sec.tests && sec.tests.length > 0))
            ) {
                loadSectionsAndTopics();
            } else {
                document.getElementById('app-container').innerHTML = '<h1 class="text-2xl text-red-500 text-center">Chyba: Nepodarilo sa načítať žiadne testy. Skontrolujte dáta testov.</h1>';
                console.error("No quiz data loaded. Check test string constants and parsing.");
            }
        }
        document.addEventListener('DOMContentLoaded', initializeAppSequence);
    </script>
</body>
</html>
